<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üöÄOPERA√á√ïES MATEM√ÅTICAS NO ESPA√áO</title>
    <style>
        /* --- ESTILOS GERAIS --- */
        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: #000;
            margin: 0;
            overflow: hidden;
            touch-action: none;
            color: white;
            user-select: none;
        }

        /* --- FUNDO ESTRELADO --- */
        .stars, .twinkling {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            display: block;
        }

        .stars {
            background: #000 url('http://www.script-tutorials.com/demos/360/images/stars.png') repeat top center;
            z-index: -2;
        }

        .twinkling {
            background: transparent url('http://www.script-tutorials.com/demos/360/images/twinkling.png') repeat top center;
            z-index: -1;
            animation: move-twink-back 200s linear infinite;
            opacity: 0.5;
        }

        @keyframes move-twink-back {
            from {background-position:0 0;}
            to {background-position:-10000px 5000px;}
        }

        /* --- BOT√ïES DO TOPO (VOLTAR E PAUSA) --- */
        .top-btn {
            position: absolute;
            top: 15px;
            background-color: rgba(0, 0, 0, 0.6);
            color: #00e676;
            border: 2px solid #00e676;
            padding: 8px 15px;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 0 5px #00e676;
            transition: all 0.2s;
            text-transform: uppercase;
        }

        .top-btn:hover {
            background-color: #00e676;
            color: black;
            box-shadow: 0 0 15px #00e676;
        }

        /* Posicionamento Espec√≠fico */
        #btnBack { left: 15px; }
        #btnPause { right: 15px; font-size: 1.2rem; padding: 5px 15px; }

        /* --- HUD (CENTRALIZADO AGORA) --- */
        .hud {
            position: absolute;
            top: 15px; 
            left: 50%;
            transform: translateX(-50%);
            width: auto;
            display: flex;
            gap: 30px;
            z-index: 10;
            font-weight: bold;
            font-size: 1.5rem;
            text-shadow: 0 0 10px #00f;
            background-color: rgba(0,0,0,0.6);
            padding: 5px 20px;
            border-radius: 10px;
            border: 1px solid #333;
        }

        .lives { color: #ff3d00; }
        .score { color: #00e676; }

        /* --- TELA DE JOGO --- */
        #game-area {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        /* --- A NAVE --- */
        .ship {
            position: absolute;
            bottom: 140px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 4rem;
            filter: drop-shadow(0 0 10px cyan);
            z-index: 5;
            transition: transform 0.1s;
        }

        /* --- METEOROS --- */
        .meteor {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 4;
            transition: top 0.1s linear;
        }

        .meteor-icon { font-size: 3.5rem; }

        .meteor-text {
            background-color: rgba(0, 0, 0, 0.7);
            border: 2px solid #ff3d00;
            border-radius: 10px;
            padding: 5px 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #fff;
            margin-top: -10px;
        }

        /* --- LASER --- */
        .laser {
            position: absolute;
            width: 6px;
            height: 20px;
            background-color: #00e676;
            border-radius: 3px;
            box-shadow: 0 0 10px #00e676;
            z-index: 3;
        }

        /* EXPLOS√ÉO */
        .explosion {
            position: absolute;
            font-size: 3rem;
            animation: fadeOut 0.5s forwards;
        }
        @keyframes fadeOut { to { opacity: 0; transform: scale(2); } }

        /* --- TECLADO VIRTUAL --- */
        .keypad {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 120px;
            background-color: rgba(20, 20, 20, 0.9);
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            padding: 5px;
            box-sizing: border-box;
            border-top: 3px solid #00e676;
            z-index: 20;
        }

        .key-btn {
            background: linear-gradient(#444, #222);
            border: 1px solid #666;
            border-radius: 5px;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 0 #000;
            transition: transform 0.1s;
        }

        .key-btn:active, .key-btn.active {
            transform: translateY(4px);
            box-shadow: none;
            background: #00e676;
            color: black;
        }

        /* --- TELAS (START / PAUSE / GAME OVER) --- */
        .screen-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
        }

        .btn-action {
            padding: 15px 40px;
            font-size: 1.5rem;
            background-color: #00e676;
            color: #003300;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
            box-shadow: 0 0 15px #00e676;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }

        @media (max-width: 600px) {
            .keypad { grid-template-columns: repeat(5, 1fr); height: 160px; }
            .ship { bottom: 180px; font-size: 3rem; }
            .hud { font-size: 1rem; top: 50px; padding: 5px 10px; width: 90%; justify-content: space-around; }
            .top-btn { font-size: 0.9rem; padding: 5px 10px; }
        }

    </style>
</head>
<body>

    <button id="btnBack" class="top-btn" onclick="window.history.back()">‚¨Ö VOLTAR</button>
    <button id="btnPause" class="top-btn" onclick="togglePause()">‚è∏Ô∏è PAUSA</button>

    <audio id="bgMusic" src="foguete.mp3" loop></audio>
    <audio id="sfxLaser" src="laser.mp3"></audio>
    <audio id="sfxBoom" src="explosao.mp3"></audio>
    <audio id="sfxOver" src="gameover.mp3"></audio>

    <div class="stars"></div>
    <div class="twinkling"></div>

    <div class="screen-overlay" id="startScreen">
        <h1 style="color: #00e676; text-shadow: 0 0 20px cyan;">OPERA√á√ïES ESPACIAIS</h1>
        <p>RESOLVA AS CONTAS PARA ATIRAR!</p>
        <p style="font-size: 0.9rem; color: #aaa;">(Use o teclado ou toque nos n√∫meros)</p>
        <button class="btn-action" onclick="startGame()">DECOLAR üöÄ</button>
    </div>

    <div class="screen-overlay" id="pauseScreen" style="display: none; background-color: rgba(0,0,0,0.8);">
        <h1 style="color: #ffeb3b;">JOGO PAUSADO</h1>
        <button class="btn-action" onclick="togglePause()">CONTINUAR ‚ñ∂Ô∏è</button>
    </div>

    <div class="screen-overlay" id="gameOverScreen" style="display: none;">
        <h1 style="color: #ff3d00;">GAME OVER</h1>
        <p>SUA PONTUA√á√ÉO FINAL:</p>
        <h2 id="finalScore" style="font-size: 3rem; margin: 10px;">0</h2>
        <button class="btn-action" onclick="restartGame()">TENTAR DE NOVO</button>
    </div>

    <div class="hud">
        <div class="score">PONTOS: <span id="scoreDisplay">0</span></div>
        <div class="lives">VIDAS: <span id="livesDisplay">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
    </div>

    <div id="game-area">
        <div class="ship" id="ship">üöÄ</div>
    </div>

    <div class="keypad" id="keypad"></div>

    <script>
        // --- VARI√ÅVEIS ---
        let gameRunning = false;
        let isPaused = false;
        let score = 0;
        let lives = 3;
        let spawnRate = 2000;
        let meteorSpeed = 1.5;
        let lastSpawnTime = 0;
        let lastFrameTime = 0; // Para calcular delta no pause

        const gameArea = document.getElementById('game-area');
        const ship = document.getElementById('ship');
        const keypad = document.getElementById('keypad');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const livesDisplay = document.getElementById('livesDisplay');
        
        let meteors = [];
        let lasers = [];

        // √Åudio
        const bgMusic = document.getElementById('bgMusic');
        const sfxLaser = document.getElementById('sfxLaser');
        const sfxBoom = document.getElementById('sfxBoom');
        const sfxOver = document.getElementById('sfxOver');

        bgMusic.volume = 0.4;
        sfxLaser.volume = 0.8;
        sfxBoom.volume = 1.0;

        // --- FUN√á√ïES DE CONTROLE ---

        function createKeypad() {
            keypad.innerHTML = '';
            for (let i = 0; i <= 9; i++) {
                const btn = document.createElement('div');
                btn.className = 'key-btn';
                btn.innerText = i;
                btn.onmousedown = (e) => { e.preventDefault(); fireNumber(i); animateKey(btn); };
                btn.ontouchstart = (e) => { e.preventDefault(); fireNumber(i); animateKey(btn); };
                keypad.appendChild(btn);
            }
        }

        function animateKey(btn) {
            btn.classList.add('active');
            setTimeout(() => btn.classList.remove('active'), 100);
        }

        window.addEventListener('keydown', (e) => {
            if (!gameRunning || isPaused) return; // N√£o atira se pausado
            if (e.key >= '0' && e.key <= '9') {
                const num = parseInt(e.key);
                fireNumber(num);
                const buttons = document.getElementsByClassName('key-btn');
                animateKey(buttons[num]);
            }
            if (e.key === 'Escape' || e.key === 'p' || e.key === 'P') {
                togglePause();
            }
        });

        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('pauseScreen').style.display = 'none';
            
            bgMusic.currentTime = 0;
            bgMusic.play().catch(e => console.log("Erro autoplay:", e));

            gameRunning = true;
            isPaused = false;
            score = 0;
            lives = 3;
            meteorSpeed = 1.5;
            spawnRate = 2500;
            meteors = [];
            lasers = [];
            lastSpawnTime = 0;
            
            document.querySelectorAll('.meteor, .laser, .explosion').forEach(e => e.remove());
            
            updateHUD();
            createKeypad();
            requestAnimationFrame(gameLoop);
        }

        function togglePause() {
            if (!gameRunning) return;

            isPaused = !isPaused;

            const pauseScreen = document.getElementById('pauseScreen');
            const btnPause = document.getElementById('btnPause');

            if (isPaused) {
                // Entrando na Pausa
                pauseScreen.style.display = 'flex';
                btnPause.style.display = 'none'; // Esconde bot√£o pequeno
                bgMusic.pause();
            } else {
                // Saindo da Pausa (Retomando)
                pauseScreen.style.display = 'none';
                btnPause.style.display = 'block';
                bgMusic.play().catch(() => {});
                
                // IMPORTANTE: Reinicia o lastSpawnTime para agora, 
                // sen√£o o jogo acha que passou muito tempo e lan√ßa meteoro na hora
                lastSpawnTime = performance.now(); 
                
                requestAnimationFrame(gameLoop);
            }
        }

        function restartGame() {
            startGame();
        }

        function gameOver() {
            gameRunning = false;
            bgMusic.pause();
            try { sfxOver.play(); } catch(e){}

            document.getElementById('finalScore').innerText = score;
            document.getElementById('gameOverScreen').style.display = 'flex';
        }

        // --- L√ìGICA DE TIRO ---
        function fireNumber(number) {
            if (isPaused) return;

            let target = null;
            let maxTop = -100;

            meteors.forEach(m => {
                if (m.answer === number) {
                    const rect = m.el.getBoundingClientRect();
                    if (rect.top > maxTop) {
                        maxTop = rect.top;
                        target = m;
                    }
                }
            });

            if (target) {
                spawnLaser(target);
            }
        }

        function spawnLaser(targetMeteor) {
            try { sfxLaser.currentTime = 0; sfxLaser.play(); } catch(e){}

            const shipRect = ship.getBoundingClientRect();
            const startX = shipRect.left + shipRect.width / 2;
            const startY = shipRect.top;

            const laserEl = document.createElement('div');
            laserEl.className = 'laser';
            laserEl.style.left = startX + 'px';
            laserEl.style.top = startY + 'px';
            document.body.appendChild(laserEl);

            lasers.push({
                el: laserEl,
                x: startX,
                y: startY,
                target: targetMeteor,
                speed: 15
            });
        }

        // --- GERADOR MATEM√ÅTICO ---
        function generateMathProblem() {
            const result = Math.floor(Math.random() * 10);
            const isPlus = Math.random() > 0.5;
            let a, b, text;

            if (isPlus) {
                a = Math.floor(Math.random() * (result + 1));
                b = result - a;
                text = `${a} + ${b}`;
            } else {
                b = Math.floor(Math.random() * 6);
                a = result + b;
                text = `${a} - ${b}`;
            }
            return { text, result };
        }

        function spawnMeteor() {
            const problem = generateMathProblem();
            const meteorEl = document.createElement('div');
            meteorEl.className = 'meteor';
            
            const icons = ['‚òÑÔ∏è', 'ü™®', 'üåë'];
            const icon = icons[Math.floor(Math.random() * icons.length)];

            meteorEl.innerHTML = `
                <div class="meteor-icon">${icon}</div>
                <div class="meteor-text">${problem.text}</div>
            `;
            
            const maxLeft = window.innerWidth - 80;
            const randomLeft = Math.random() * maxLeft;
            
            meteorEl.style.left = randomLeft + 'px';
            meteorEl.style.top = '-100px';

            gameArea.appendChild(meteorEl);

            meteors.push({
                el: meteorEl,
                y: -100,
                x: randomLeft,
                answer: problem.result
            });
        }

        function createExplosion(x, y) {
            const exp = document.createElement('div');
            exp.className = 'explosion';
            exp.innerText = 'üí•';
            exp.style.left = x + 'px';
            exp.style.top = y + 'px';
            document.body.appendChild(exp);
            setTimeout(() => exp.remove(), 500);
        }

        // --- GAME LOOP ---
        function gameLoop(timestamp) {
            if (!gameRunning) return;
            
            // SE ESTIVER PAUSADO, N√ÉO ATUALIZA E N√ÉO CHAMA O PR√ìXIMO FRAME
            if (isPaused) return;

            if (!lastSpawnTime) lastSpawnTime = timestamp;

            // Spawner
            if (timestamp - lastSpawnTime > spawnRate) {
                spawnMeteor();
                lastSpawnTime = timestamp;
                
                if (spawnRate > 800) spawnRate -= 20;
                meteorSpeed += 0.01;
            }

            // Atualiza Meteoros
            meteors = meteors.filter(m => {
                m.y += meteorSpeed;
                m.el.style.top = m.y + 'px';

                if (m.y > window.innerHeight) {
                    lives--;
                    updateHUD();
                    m.el.remove();
                    
                    document.body.style.backgroundColor = '#500';
                    setTimeout(() => document.body.style.backgroundColor = '#000', 100);

                    if (lives <= 0) {
                        gameOver();
                        return false; 
                    }
                    return false;
                }
                return true;
            });

            // Atualiza Lasers
            lasers = lasers.filter(l => {
                if (!meteors.includes(l.target)) {
                    l.el.remove();
                    return false;
                }

                const targetX = l.target.x + 30;
                const targetY = l.target.y + 30;
                const dx = targetX - l.x;
                const dy = targetY - l.y;
                const dist = Math.sqrt(dx*dx + dy*dy);

                if (dist < l.speed) {
                    createExplosion(targetX, targetY);
                    try { sfxBoom.currentTime = 0; sfxBoom.play(); } catch(e){}
                    
                    l.el.remove();
                    l.target.el.remove();
                    
                    const meteorIndex = meteors.indexOf(l.target);
                    if (meteorIndex > -1) meteors.splice(meteorIndex, 1);

                    score += 10;
                    updateHUD();
                    return false;
                } else {
                    l.x += (dx / dist) * l.speed;
                    l.y += (dy / dist) * l.speed;
                    l.el.style.left = l.x + 'px';
                    l.el.style.top = l.y + 'px';
                    
                    const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                    l.el.style.transform = `rotate(${angle + 90}deg)`;
                    
                    return true;
                }
            });

            requestAnimationFrame(gameLoop);
        }

        function updateHUD() {
            scoreDisplay.innerText = score;
            let hearts = '';
            for(let i=0; i<lives; i++) hearts += '‚ù§Ô∏è';
            livesDisplay.innerText = hearts;
        }

    </script>
</body>
</html>