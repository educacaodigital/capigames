<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ü¶ìSAFARI DA MEM√ìRIA</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

  <style>
    :root {
      --bg-color: #A0D2EB;
      --card-back: #FFB347;
      --card-success: #90EE90;
      --card-error: #FF6961;
      --text-color: #555;
      
      /* Vari√°vel de tamanho controlada pelo JS */
      --tamanho-carta: 110px; 
    }

    body {
      font-family: 'Fredoka', sans-serif;
      background-color: var(--bg-color);
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      user-select: none;
    }

    /* CABE√áALHO */
    header {
      text-align: center;
      margin: 15px 0;
      width: 95%;
      max-width: 1000px;
    }

    .titulo {
      color: #fff;
      font-size: 2.5rem;
      text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
      margin: 0 0 10px 0;
    }

    /* PAINEL */
    .painel {
      background: white;
      padding: 10px 30px;
      border-radius: 50px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      box-shadow: 0 4px 0 rgba(0,0,0,0.1);
      font-size: 1.3rem;
      color: var(--text-color);
      font-weight: bold;
      box-sizing: border-box;
    }

    .nivel-badge {
      background-color: #6c5ce7;
      color: white;
      padding: 5px 20px;
      border-radius: 20px;
      font-size: 0.9em;
    }

    .info-item { display: flex; align-items: center; gap: 10px; }
    .estrelas { color: gold; letter-spacing: 3px; }
    
    .botoes-controle {
        display: flex;
        gap: 15px;
    }

    .btn-icon {
        border: none;
        background: none;
        cursor: pointer;
        font-size: 1.3rem;
        color: #555;
        transition: transform 0.2s;
    }
    .btn-icon:hover { transform: scale(1.1); color: #6c5ce7; }

    /* √ÅREA DO JOGO (Horizontal) */
    .game-area {
      flex-grow: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      width: 100%;
      max-width: 1200px; 
    }

    .game-container {
      display: grid;
      gap: 15px;
      perspective: 1000px;
      justify-content: center;
      align-content: center;
    }

    /* CARTAS */
    .card {
      width: var(--tamanho-carta);
      height: var(--tamanho-carta);
      position: relative;
      cursor: pointer;
      transform: scale(1);
      transition: transform 0.1s;
    }
    .card:active { transform: scale(0.95); }

    .card-inner {
      width: 100%; height: 100%;
      position: absolute;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }

    .card.flipped .card-inner { transform: rotateY(180deg); }
    .card.correto .card-inner { animation: pulo 0.5s ease-in-out; }
    .card.correto .card-back { background-color: var(--card-success); border-color: #72c772; }
    .card.erro .card-inner { animation: tremer 0.4s ease-in-out; }
    .card.erro .card-back { background-color: var(--card-error); }

    .card-front, .card-back {
      position: absolute; width: 100%; height: 100%;
      backface-visibility: hidden;
      border-radius: 15px;
      display: flex; justify-content: center; align-items: center;
      border: 4px solid white;
      box-shadow: 0 6px 0 rgba(0,0,0,0.1);
      box-sizing: border-box;
    }

    .card-front { 
      background-color: var(--card-back); 
      color: white; 
      font-size: calc(var(--tamanho-carta) / 2.5); 
    }
    .card-back { background-color: #fff; transform: rotateY(180deg); }
    .card-back img { width: 80%; height: 80%; object-fit: contain; }

    @keyframes pulo { 0%,100%{transform:rotateY(180deg) scale(1)} 50%{transform:rotateY(180deg) scale(1.15)} }
    @keyframes tremer { 0%,100%{transform:rotateY(180deg) translateX(0)} 25%{transform:rotateY(180deg) translateX(-5px)} 75%{transform:rotateY(180deg) translateX(5px)} }

    /* MODAL */
    #modal-nivel {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85);
      display: none;
      justify-content: center; align-items: center; z-index: 100;
    }
    .modal-content {
      background: white; padding: 40px; border-radius: 20px; text-align: center;
      animation: modalUp 0.3s ease-out;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    @keyframes modalUp { from {transform: scale(0.5);} to {transform: scale(1);} }
    
    .btn-proximo {
      background: #6c5ce7; color: white; border: none; padding: 15px 40px;
      font-size: 1.5rem; border-radius: 50px; cursor: pointer; margin-top: 25px; font-weight: bold;
      box-shadow: 0 5px 0 #4834d4; transition: transform 0.1s;
    }
    .btn-proximo:active { transform: translateY(5px); box-shadow: none; }

    /* Responsividade */
    @media (max-width: 800px) {
      .game-container { gap: 8px; }
      :root { --tamanho-carta: 75px !important; }
      .titulo { font-size: 1.8rem; }
      .painel { font-size: 0.9rem; flex-wrap: wrap; justify-content: center; gap: 15px; }
    }
  </style>
</head>
<body>
  
  <header>
    <h1 class="titulo">Safari da Mem√≥ria</h1>
    
    <div class="painel">
      <div class="nivel-badge">N√≠vel <span id="nivel-atual">1</span></div>
      <div class="info-item"><i class="fas fa-hand-pointer"></i> <span id="jogadas">0</span></div>
      <div class="info-item"><i class="fas fa-stopwatch"></i> <span id="tempo">00:00</span></div>
      <div class="info-item"><span id="estrelas" class="estrelas">‚òÖ‚òÖ‚òÖ</span></div>
      
      <div class="botoes-controle">
          <button onclick="alternarMusica()" class="btn-icon" title="Ligar/Desligar M√∫sica">
            <i id="icone-musica" class="fas fa-music"></i>
          </button>
          
          <button onclick="reiniciarNivel()" class="btn-icon" title="Reiniciar N√≠vel">
            <i class="fas fa-redo"></i>
          </button>
      </div>
    </div>
  </header>

  <div class="game-area">
    <div class="game-container" id="game"></div>
  </div>

  <div id="modal-nivel">
    <div class="modal-content">
      <h1 style="margin:0; font-size: 4rem;">üéâ</h1>
      <h2 style="color: #6c5ce7; margin: 10px 0;">N√≠vel Conclu√≠do!</h2>
      <p id="msg-vitoria" style="font-size: 1.2rem; color: #555;">Excelente mem√≥ria!</p>
      <button class="btn-proximo" onclick="proximoNivel()">Pr√≥ximo N√≠vel <i class="fas fa-arrow-right"></i></button>
    </div>
  </div>

  <audio id="musica-fundo" loop>
      <source src="musicajogo.mp3" type="audio/mpeg">
  </audio>

  <script>
    // ====== 1. BANCO DE IMAGENS ======
    const todosAnimais = [
      "img/coala.png", "img/gato.png", "img/leao.png", "img/panda.png",
      "img/porco.png", "img/raposa.png", "img/tigre.png", "img/urso.png",
      "img/elefante.png", "img/girafa.png", "img/macaco.png", "img/zebra.png"
    ];

    // ====== 2. CONFIGURA√á√ÉO HORIZONTAL ======
    const niveis = [
      { pares: 3, colunas: 3, tamanho: 170 }, 
      { pares: 6, colunas: 4, tamanho: 140 }, 
      { pares: 8, colunas: 4, tamanho: 130 }, 
      { pares: 10, colunas: 5, tamanho: 120 }, 
      { pares: 12, colunas: 6, tamanho: 115 }
    ];

    // Vari√°veis Globais
    let nivelAtual = 0;
    let viradas = [];
    let bloqueado = false;
    let jogadas = 0;
    let paresEncontrados = 0;
    let timerInterval;
    let segundos = 0;
    let jogoIniciado = false;
    
    // Controle de M√∫sica
    let musicaTocando = false;
    const audioFundo = document.getElementById('musica-fundo');
    const iconeMusica = document.getElementById('icone-musica');

    // Elementos DOM
    const container = document.getElementById('game');
    const elJogadas = document.getElementById('jogadas');
    const elTempo = document.getElementById('tempo');
    const elEstrelas = document.getElementById('estrelas');
    const elNivel = document.getElementById('nivel-atual');
    const modal = document.getElementById('modal-nivel');

    // ====== FUN√á√ïES ======

    // Fun√ß√£o para ligar/desligar m√∫sica
    function alternarMusica() {
        if (musicaTocando) {
            audioFundo.pause();
            iconeMusica.className = "fas fa-volume-mute";
            iconeMusica.style.color = "#FF6961";
        } else {
            audioFundo.volume = 0.2; // Volume baixo (20%)
            audioFundo.play().catch(e => console.log("Intera√ß√£o necess√°ria para tocar √°udio"));
            iconeMusica.className = "fas fa-music";
            iconeMusica.style.color = "#6c5ce7";
        }
        musicaTocando = !musicaTocando;
    }

    // Tentar tocar a m√∫sica na primeira intera√ß√£o
    function tentarTocarMusicaAuto() {
        if (!musicaTocando) {
            alternarMusica();
        }
    }

    function embaralhar(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function iniciarJogo() {
      const config = niveis[nivelAtual];
      
      viradas = [];
      bloqueado = false;
      jogadas = 0;
      paresEncontrados = 0;
      segundos = 0;
      jogoIniciado = false;
      pararTimer();
      
      elJogadas.innerText = "0";
      elTempo.innerText = "00:00";
      elEstrelas.innerText = "‚òÖ‚òÖ‚òÖ";
      elNivel.innerText = nivelAtual + 1;
      modal.style.display = "none";

      container.style.gridTemplateColumns = `repeat(${config.colunas}, 1fr)`;
      document.documentElement.style.setProperty('--tamanho-carta', `${config.tamanho}px`);
      
      let listaCartas = [];
      let animaisDoNivel = embaralhar([...todosAnimais]);

      for (let i = 0; i < config.pares; i++) {
        let img = animaisDoNivel[i % animaisDoNivel.length];
        listaCartas.push(img);
        listaCartas.push(img);
      }

      listaCartas = embaralhar(listaCartas);
      renderizarCartas(listaCartas);
    }

    function renderizarCartas(cartas) {
      container.innerHTML = '';
      cartas.forEach(imgSrc => {
        const card = document.createElement('div');
        card.classList.add('card');
        card.dataset.animal = imgSrc;

        card.innerHTML = `
          <div class="card-inner">
            <div class="card-front">?</div>
            <div class="card-back">
              <img src="${imgSrc}" alt="Animal">
            </div>
          </div>
        `;
        card.addEventListener('click', () => virarCarta(card));
        container.appendChild(card);
      });
    }

    function virarCarta(carta) {
      // Tenta iniciar a m√∫sica no primeiro clique se ainda n√£o estiver tocando
      tentarTocarMusicaAuto();

      if (!jogoIniciado) {
        iniciarTimer();
        jogoIniciado = true;
      }

      if (bloqueado || carta.classList.contains('flipped')) return;

      carta.classList.add('flipped');
      viradas.push(carta);

      if (viradas.length === 2) {
        jogadas++;
        elJogadas.innerText = jogadas;
        atualizarEstrelas();
        bloqueado = true;
        checarPar();
      }
    }

    function checarPar() {
      const [c1, c2] = viradas;
      const animal1 = c1.dataset.animal;
      const animal2 = c2.dataset.animal;

      if (animal1 === animal2) {
        paresEncontrados++;
        c1.classList.add('correto');
        c2.classList.add('correto');
        
        const nomeLimpo = animal1.replace("img/", "").replace(".png", "");
        falar(nomeLimpo);

        resetarJogada();
        
        if (paresEncontrados === niveis[nivelAtual].pares) {
          setTimeout(mostrarVitoria, 800);
        }
      } else {
        c1.classList.add('erro');
        c2.classList.add('erro');
        setTimeout(() => {
          c1.classList.remove('flipped', 'erro');
          c2.classList.remove('flipped', 'erro');
          resetarJogada();
        }, 1000);
      }
    }

    function resetarJogada() {
      viradas = [];
      bloqueado = false;
    }

    function atualizarEstrelas() {
      const pares = niveis[nivelAtual].pares;
      if (jogadas <= pares + 2) elEstrelas.innerText = "‚òÖ‚òÖ‚òÖ";
      else if (jogadas <= pares + 6) elEstrelas.innerText = "‚òÖ‚òÖ‚òÜ";
      else elEstrelas.innerText = "‚òÖ‚òÜ‚òÜ";
    }

    function iniciarTimer() {
      timerInterval = setInterval(() => {
        segundos++;
        const m = Math.floor(segundos / 60).toString().padStart(2, '0');
        const s = (segundos % 60).toString().padStart(2, '0');
        elTempo.innerText = `${m}:${s}`;
      }, 1000);
    }

    function pararTimer() {
      clearInterval(timerInterval);
    }

    function mostrarVitoria() {
      pararTimer();
      const msg = document.getElementById('msg-vitoria');
      const btn = document.querySelector('.btn-proximo');

      if (nivelAtual < niveis.length - 1) {
        msg.innerText = `N√≠vel ${nivelAtual + 1} completo em ${elTempo.innerText}!`;
        btn.innerHTML = `Ir para N√≠vel ${nivelAtual + 2} <i class="fas fa-arrow-right"></i>`;
        btn.onclick = proximoNivel;
      } else {
        msg.innerText = "PARAB√âNS! Voc√™ zerou todos os n√≠veis!";
        btn.innerHTML = `Jogar Novamente <i class="fas fa-redo"></i>`;
        btn.onclick = () => {
            nivelAtual = 0;
            iniciarJogo();
        };
      }
      modal.style.display = "flex";
    }

    function proximoNivel() {
      if (nivelAtual < niveis.length - 1) {
        nivelAtual++;
        iniciarJogo();
      }
    }

    function reiniciarNivel() {
      if(confirm("Reiniciar este n√≠vel?")) {
        iniciarJogo();
      }
    }

    function falar(texto) {
      if ('speechSynthesis' in window) {
        const voz = new SpeechSynthesisUtterance(texto);
        voz.lang = 'pt-BR';
        voz.rate = 0.9;
        window.speechSynthesis.speak(voz);
      }
    }

    iniciarJogo();

  </script>
</body>
</html>