<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CAPIGAMES</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <script src="games-manifest.js" defer></script>

  <style>
    :root{
      --grad: linear-gradient(135deg,#7c4dff 0%, #8e2de2 40%, #ff5fa3 100%);
      --card-shadow: 0 10px 20px rgba(0,0,0,.1); /* Sombra um pouco mais suave */
    }
    body{box-sizing:border-box}
    .hero{
      background: radial-gradient(1200px 400px at 50% -50%, rgba(255,255,255,.35), transparent 60%), var(--grad);
    }
    .age-card{
      background:#fff;
      border-radius:20px; /* Arredondamento levemente reduzido */
      box-shadow: var(--card-shadow);
      transition: transform .2s ease, box-shadow .2s ease;
      position:relative;
      overflow:hidden;
    }
    .age-card:hover{ transform: translateY(-3px); box-shadow: 0 15px 30px rgba(0,0,0,.15); }
    .age-chip{ font-size:.65rem; letter-spacing:.05em; font-weight: 700; } /* Chip menor */
    .glow{
      position:absolute; inset:-2px;
      background: conic-gradient(from 0deg,#ffd166,#fca5f1,#a78bfa,#60a5fa,#34d399,#ffd166);
      filter: blur(30px); opacity:.25;
      animation: spin 8s linear infinite;
    }
    @keyframes spin{ to{ transform:rotate(1turn)} }

    /* CAPI (mascote) */
    .capi-bubble{
      position:relative; background:#fff; border-radius:16px; padding:12px; margin:8px; box-shadow:var(--card-shadow)
    }
    .capi-bubble:after{
      content:''; position:absolute; bottom:-10px; left:24px; border:10px solid transparent; border-top-color:#fff
    }
    
    /* cards dos jogos (Thumbnails) */
    .game-card{
      background:linear-gradient(135deg,#667eea 0%, #764ba2 100%);
      border-radius:16px; padding:10px; color:#fff; text-align:center;
      transition:transform .18s ease, box-shadow .18s ease;
      display: flex; flex-direction: column; justify-content: space-between;
      overflow: hidden;
    }
    .game-card:hover{ transform:scale(1.02); box-shadow: 0 8px 20px rgba(0,0,0,0.3); }
    
    .game-thumb-container {
      width: 100%;
      aspect-ratio: 16/9;
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 8px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hidden{display:none}
  </style>
</head>
<body class="min-h-screen hero text-gray-900">

  <header class="bg-white/60 backdrop-blur-sm sticky top-0 z-40 shadow">
    <div class="container mx-auto px-4 py-2 flex items-center justify-between">
		<div class="flex items-center gap-3 relative">
		  <img src="img/capi_logo.png" alt="Capi" class="object-contain transform -translate-y-1 hover:-translate-y-2 transition-all duration-300" style="width: 8em">
		  <h1 class="text-xl md:text-2xl font-extrabold text-purple-700 uppercase tracking-wide drop-shadow-sm">
			CAPIGAMES
		  </h1>
		</div>
		<div class="flex items-center gap-2">
			<button id="toggleCapi" class="bg-yellow-400 hover:bg-yellow-500 text-purple-900 font-bold py-1 px-3 text-xs md:text-sm rounded-full">
				<span id="capiToggleText">DESABILITAR CAPI</span>
			</button>
			<button id="refreshBtn" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-1 px-3 text-xs md:text-sm rounded-full" title="Recarregar">
			  üîÑ
			</button>
		</div>
    </div>
  </header>

  <section class="text-center py-6">
    <h1 class="text-2xl md:text-4xl font-extrabold text-white drop-shadow-lg mb-1">MUNDO DO CAPIGAMES</h1>
    <p class="text-white/90 text-sm uppercase max-w-2xl mx-auto">explore, aprenda e divirta-se com jogos educativos!</p>

    <div class="mt-4">
      <button id="toggleSearchBtn" class="mx-auto bg-white text-purple-700 hover:bg-purple-50 font-bold py-2 px-5 text-sm rounded-full shadow">
        üîé BUSCAR JOGOS
      </button>
    </div>
  </section>

  <main class="container mx-auto px-4 pb-12">

    <section id="searchBar" class="max-w-3xl mx-auto mb-6 bg-white/95 backdrop-blur-sm rounded-2xl p-4 shadow-xl hidden">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <div class="md:col-span-2">
          <label class="block text-xs font-semibold text-gray-700 mb-1">Palavra-chave</label>
          <input id="q" type="text" placeholder="Nome do jogo..." class="w-full p-2 text-sm border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:outline-none uppercase">
        </div>
        <div>
          <label class="block text-xs font-semibold text-gray-700 mb-1">Categoria</label>
          <select id="categoryFilter" class="w-full p-2 text-sm border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:outline-none">
            <option value="">Todas</option>
          </select>
        </div>
      </div>
      <div class="mt-2 flex gap-2 items-center">
        <button id="clearBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-1 px-3 text-xs rounded-full">üóëÔ∏è Limpar</button>
        <div id="manifestInfo" class="text-xs text-gray-500"></div>
      </div>
    </section>
	
    <section id="searchResults" class="hidden mt-4 mb-6">
      <div id="resultsList" class="bg-white/95 backdrop-blur-sm rounded-2xl p-4 shadow-xl"></div>
    </section>	

    <section id="ageGroupsSection" class="grid grid-cols-1 md:grid-cols-3 gap-4" style="text-align: center;">
      
      <div class="age-card p-4 cursor-pointer" onclick="openCategory('1-3')">
        <div class="glow"></div>
        <div class="relative">
          <div class="text-4xl mb-2">üß∏</div>
          <h3 class="text-lg font-extrabold text-purple-600">3 ANOS</h3>
          <p class="text-purple-400 text-xs -mt-1">CORES E FORMAS</p>
          <div class="mt-3">
            <span class="inline-block bg-rose-100 text-rose-600 px-2 py-0.5 rounded-full age-chip">EXPLORA√á√ÉO SENSORIAL</span>
            <div class="text-[10px] text-rose-500 mt-0.5">RECONHECIMENTO B√ÅSICO</div>
          </div>
        </div>
      </div>

      <div class="age-card p-4 cursor-pointer" onclick="openCategory('4-5')">
        <div class="glow"></div>
        <div class="relative">
          <div class="text-4xl mb-2">üß©</div>
          <h3 class="text-lg font-extrabold text-emerald-600">4 E 5 ANOS</h3>
          <p class="text-emerald-400 text-xs -mt-1">LETRAS E N√öMEROS</p>
          <div class="mt-3">
            <span class="inline-block bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full age-chip">ALFABETIZA√á√ÉO</span>
            <div class="text-[10px] text-blue-500 mt-0.5">PRIMEIRAS PALAVRAS</div>
          </div>
        </div>
      </div>

      <div class="age-card p-4 cursor-pointer" onclick="openCategory('6-10')">
        <div class="glow"></div>
        <div class="relative">
          <div class="text-4xl mb-2">üßÆ</div>
          <h3 class="text-lg font-extrabold text-green-600">6 A 10 ANOS</h3>
          <p class="text-green-400 text-xs -mt-1">LEITURA E MATEM√ÅTICA</p>
          <div class="mt-3">
            <span class="inline-block bg-green-100 text-green-600 px-2 py-0.5 rounded-full age-chip">RACIOC√çNIO L√ìGICO</span>
            <div class="text-[10px] text-green-500 mt-0.5">RESOLU√á√ÉO DE PROBLEMAS</div>
          </div>
        </div>
      </div>

      <div class="age-card p-4 cursor-pointer" onclick="openCategory('11-14')">
        <div class="glow"></div>
        <div class="relative">
          <div class="text-4xl mb-2">üî¨</div>
          <h3 class="text-lg font-extrabold text-indigo-600">11 A 14 ANOS</h3>
          <p class="text-indigo-400 text-xs -mt-1">CI√äNCIAS E CULTURA</p>
          <div class="mt-3">
            <span class="inline-block bg-indigo-100 text-indigo-600 px-2 py-0.5 rounded-full age-chip">PENSAMENTO CR√çTICO</span>
            <div class="text-[10px] text-indigo-500 mt-0.5">PROJETOS AVAN√áADOS</div>
          </div>
        </div>
      </div>

      <div class="age-card p-4 cursor-pointer" onclick="openCategory('naee')">
        <div class="glow"></div>
        <div class="relative">
          <div class="text-4xl mb-2">üåª</div>
          <h3 class="text-lg font-extrabold text-orange-600">SALA DO AEE</h3>
          <p class="text-orange-400 text-xs -mt-1">EDUCA√á√ÉO ESPECIAL</p>
          <div class="mt-3">
            <span class="inline-block bg-orange-100 text-orange-600 px-2 py-0.5 rounded-full age-chip">JOGOS ADAPTADOS</span>
            <div class="text-[10px] text-orange-500 mt-0.5">INCLUS√ÉO E ACESSIBILIDADE</div>
          </div>
        </div>
      </div>

      <div class="age-card p-4 cursor-pointer" onclick="openCategory('computacional')">
        <div class="glow"></div>
        <div class="relative">
          <div class="text-4xl mb-2">ü§ñ</div>
          <h3 class="text-lg font-extrabold text-cyan-600">COMPUTA√á√ÉO</h3>
          <p class="text-cyan-400 text-xs -mt-1">PENSAMENTO COMPUTACIONAL</p>
          <div class="mt-3">
            <span class="inline-block bg-cyan-100 text-cyan-600 px-2 py-0.5 rounded-full age-chip">L√ìGICA E ALGORITMOS</span>
            <div class="text-[10px] text-cyan-500 mt-0.5">PROGRAMA√á√ÉO DESPLUGADA</div>
          </div>
        </div>
      </div>
    </section>

    <section id="gamesSection" class="hidden mt-8">
      <div class="flex items-center justify-between mb-4">
        <h3 id="gamesSectionTitle" class="text-xl font-bold text-white drop-shadow">Jogos</h3>
        <button onclick="backHome()" class="bg-white/90 hover:bg-white text-purple-700 font-bold py-1 px-4 text-sm rounded-full shadow">‚¨ÖÔ∏è Voltar</button>
      </div>
      <div id="gamesGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
    </section>
  </main>

  <div id="capiContainer" class="fixed bottom-4 right-4 flex flex-col items-end gap-2">
	  <div id="capiSpeech" class="capi-bubble hidden max-w-xs">
		<p id="capiMessage" class="text-purple-800 font-semibold text-sm"></p>
	  </div>
	  <div id="capi" class="cursor-pointer bg-orange-400 rounded-full shadow-2xl hover:bg-orange-500 flex items-center justify-center w-20 h-20" title="CAPI ‚Äî seu ajudante!">
		<img src="img/capi2.png" alt="Capi" class="object-contain rounded-full">
	  </div>
	</div>

	<script>
    /* ======= CONFIG ======= */
    const BASE_DIR = "games";
    const CATEGORY_ORDER = ["1-3","4-5","6-10","11-14","naee", "computacional"];
    const CATEGORY_TITLES = {
      "1-3":"JOGOS PARA 3 ANOS",
      "4-5":"JOGOS PARA 4 E 5 ANOS",
      "6-10":"JOGOS PARA 6 A 10 ANOS",
      "11-14":"JOGOS PARA 11 A 14 ANOS",
      "naee":"SALA DO AEE - EDUCA√á√ÉO ESPECIAL",
      "computacional": "PENSAMENTO COMPUTACIONAL E L√ìGICA"
    };

    let entries = [];
    let presentCategories = new Set();
    let capiEnabled = true;

    // Refs UI
    const $ = s => document.querySelector(s);
    const searchBar = $("#searchBar");
    const manifestInfo = $("#manifestInfo");
    const ageGroupsSection = $("#ageGroupsSection");
    const searchResults = $("#searchResults");
    const resultsList = $("#resultsList");
    const gamesSection = $("#gamesSection");
    const gamesGrid = $("#gamesGrid");
    const gamesSectionTitle = $("#gamesSectionTitle");
    const qEl = $("#q");
    const categoryFilterEl = $("#categoryFilter");
    const clearBtn = $("#clearBtn");
    const toggleSearchBtn = $("#toggleSearchBtn");
    const refreshBtn = $("#refreshBtn");

    /* ======= CAPI (assistente) ======= */
    function showCapiMessage(message){
      if(!capiEnabled) return;
      const speech = $("#capiSpeech");
      $("#capiMessage").textContent = message;
      speech.classList.remove("hidden");
      setTimeout(()=>speech.classList.add("hidden"), 3000);
    }
    $("#capi").addEventListener("click", ()=> showCapiMessage("POSSO AJUDAR! CLIQUE EM UMA CATEGORIA OU BUSQUE UM JOGO. üêπ"));
    $("#toggleCapi").addEventListener("click", ()=>{
      capiEnabled = !capiEnabled;
      $("#capiContainer").style.display = capiEnabled ? "block" : "none";
      $("#capiToggleText").textContent = capiEnabled ? "‚ùå CAPI" : "‚úÖ CAPI";
      if(capiEnabled) showCapiMessage("OBA! VOLTEI! üéâ");
    });

    /* ======= HELPERS ======= */
    const normalizeSlashes = p => p.replace(/\\/g,'/');
    const stripLeadingDots = p => p.replace(/^[.\/]+/,'');
    function firstFolderAfterBase(relPath){
      const p = normalizeSlashes(relPath);
      const parts = p.split('/').filter(Boolean);
      if(parts.length===0) return "";
      if (parts[0].toLowerCase() === BASE_DIR.toLowerCase()) return parts[1]?.toLowerCase() || "";
      return parts[0].toLowerCase();
    }
    function normalizeCategoryFromPath(relPath){
      const root = firstFolderAfterBase(relPath);
      return CATEGORY_ORDER.includes(root) ? root : null;
    }

    function renderFilters(){
      const cats = CATEGORY_ORDER.filter(c=>presentCategories.has(c));
      categoryFilterEl.innerHTML = `<option value="">Todas</option>` + cats.map(c=>`<option value="${c}">${c}</option>`).join("");
    }

    // ==== GRID DE JOGOS COM IMAGEM ====
    function drawGamesGrid(list){
      if(list.length===0){
        gamesGrid.innerHTML = `<div class="col-span-full text-center py-8 text-white/90">
          <div class="text-4xl mb-2">üòî</div><p class="text-xl font-bold">NENHUM JOGO ENCONTRADO</p></div>`;
        return;
      }
      
      gamesGrid.innerHTML = list.map(item => {
        // Tenta prever a imagem
        const thumbPath = item.path.replace(/\.html?$/i, ".png");
        return `
        <a href="${encodeURI(item.path)}" class="game-card group" title="${item.title}">
          <div class="game-thumb-container">
            <img 
              src="${encodeURI(thumbPath)}" 
              alt="${item.title}" 
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
              onerror="this.style.display='none'; this.nextElementSibling.classList.remove('hidden')"
            >
            <div class="hidden absolute inset-0 flex items-center justify-center text-3xl text-white/50">
               üéÆ
            </div>
          </div>
          <div class="font-bold uppercase tracking-wider text-xs md:text-sm line-clamp-2">${item.title}</div>
        </a>
      `}).join("");
    }

    /* ======= BUSCA ======= */
    function renderSearchResults(){
      const q = (qEl.value||"").trim().toUpperCase();
      const catFilter = categoryFilterEl.value;

      if(!q && !catFilter){
        searchResults.classList.add("hidden");
        resultsList.innerHTML = "";
        return;
      }

      let filtered = entries.filter(e=>{
        const inCat = !catFilter || e.category===catFilter;
        const t = (e.title||"").toUpperCase();
        const p = (e.path ||"").toUpperCase();
        const inText = !q || t.includes(q) || p.includes(q);
        return inCat && inText;
      });

      if(filtered.length===0){
        searchResults.classList.remove("hidden");
        resultsList.innerHTML = `<div class="text-center text-gray-600 py-4 text-sm">Nenhum jogo encontrado.</div>`;
        return;
      }

      const html = filtered.map(e=>`
        <a href="${encodeURI(e.path)}" class="flex items-center justify-between gap-3 px-3 py-2 rounded-lg hover:bg-purple-50 transition text-sm">
          <div class="truncate">
            <div class="font-semibold text-purple-700 truncate">${e.title}</div>
          </div>
          <span class="text-[10px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-700 uppercase whitespace-nowrap">${e.category}</span>
        </a>
      `).join("");

      resultsList.innerHTML = html;
      searchResults.classList.remove("hidden");
    }

    toggleSearchBtn.addEventListener("click", ()=>{
      const open = searchBar.classList.contains("hidden");
      searchBar.classList.toggle("hidden");
      if(open) { showCapiMessage("VAMOS BUSCAR! üîç"); }
      else { showCapiMessage("TELA PRINCIPAL! üè†"); searchResults.classList.add("hidden"); qEl.value=""; categoryFilterEl.value=""; }
    });
    clearBtn.addEventListener("click", ()=>{
      qEl.value=""; categoryFilterEl.value=""; renderSearchResults();
    });
    qEl.addEventListener("input", renderSearchResults);
    categoryFilterEl.addEventListener("change", renderSearchResults);

    /* ======= LOAD MANIFEST ======= */
    function loadManifest(){
      const m = window.CAPI_MANIFEST;
      if(!m || !Array.isArray(m.entries)){
        manifestInfo.innerHTML = `<span class="text-rose-600 font-semibold">Manifesto ausente.</span>`;
        showCapiMessage("Erro no manifesto. üìÑ");
        return false;
      }
      const fixed = [];
      for(const e of m.entries){
        if(!e || !e.path) continue;
        const p = stripLeadingDots(normalizeSlashes(e.path));
        const cat = normalizeCategoryFromPath(p);
        if(!cat) continue;
        const withBase = p.toLowerCase().startsWith(BASE_DIR.toLowerCase()+"/") ? p : `${BASE_DIR}/${p}`;
        fixed.push({ path: withBase, title: e.title || withBase.split("/").pop().replace(/\.html?$/i,""), category: cat });
      }
      entries = fixed;
      presentCategories = new Set(entries.map(e=>e.category));
      renderFilters();
      manifestInfo.textContent = `${entries.length} jogos carregados`;
      return true;
    }

    /* ======= NAV ======= */
    function openCategory(cat){
      const list = entries.filter(e=>e.category===cat);
      gamesSectionTitle.textContent = CATEGORY_TITLES[cat] || "Jogos";
      ageGroupsSection.classList.add("hidden");
      searchBar.classList.add("hidden");
      searchResults.classList.add("hidden");
      gamesSection.classList.remove("hidden");
      drawGamesGrid(list);
      showCapiMessage(`BOA ESCOLHA! üí°`);
    }
    function backHome(){
      gamesSection.classList.add("hidden");
      ageGroupsSection.classList.remove("hidden");
      showCapiMessage("TELA PRINCIPAL! üè†");
    }

    /* ======= INIT ======= */
    refreshBtn.addEventListener("click", ()=>location.reload());

    window.addEventListener("DOMContentLoaded", ()=>{
      loadManifest();
      setTimeout(()=> showCapiMessage("OL√Å! VAMOS JOGAR? üéÆ"), 800);
    });

    window.openCategory = openCategory;
    window.backHome = backHome;
  </script>
</body>
</html>