<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogos Pedag√≥gicos - Capi Games v2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        @keyframes dance {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-5deg) scale(1.1); }
            50% { transform: rotate(5deg) scale(1.1); }
            75% { transform: rotate(-3deg) scale(1.05); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }
        
        .bounce { animation: bounce 2s infinite; }
        .dance { animation: dance 1s ease-in-out; }
        .float { animation: float 3s ease-in-out infinite; }
        
        .age-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .age-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .speech-bubble {
            position: relative;
            background: white;
            border-radius: 20px;
            padding: 15px;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .speech-bubble:after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 30px;
            width: 0;
            height: 0;
            border: 10px solid transparent;
            border-top-color: white;
        }
        
        .game-preview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            color: white;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .game-preview:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="min-h-full bg-gradient-to-br from-blue-400 via-purple-500 to-pink-400">
    <!-- Header -->
    <header class="bg-white/90 backdrop-blur-sm shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <img src="https://www.riopreto.sp.leg.br/Content/css/images/logo-1.png" alt="Logo C√¢mara Municipal" class="h-12 w-auto" onerror="this.src=''; this.alt='Logo n√£o dispon√≠vel'; this.style.display='none';">
                <h1 class="text-3xl font-bold text-purple-600 uppercase">CAPI GAMES v2</h1>
            </div>
            
            <div class="flex items-center space-x-4">
                <button id="toggleCapi" class="bg-yellow-400 hover:bg-yellow-500 text-purple-800 font-bold py-2 px-4 rounded-full transition-colors">
                    <span id="capiToggleText">üêπ DESABILITAR CAPI</span>
                </button>
                <button onclick="checkForUpdates()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full">
                    üîÑ ATUALIZAR JOGOS
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Welcome Section -->
        <div class="text-center mb-12">
            <h2 class="text-5xl font-bold text-white mb-4 drop-shadow-lg">
                BEM-VINDOS AO MUNDO DOS JOGOS!
            </h2>
            <p class="text-xl text-white/90 max-w-3xl mx-auto drop-shadow uppercase">
                EXPLORE, APRENDA E DIVIRTA-SE COM JOGOS EDUCATIVOS CRIADOS ESPECIALMENTE PARA CADA IDADE!
            </p>
        </div>

        <!-- Search Section -->
        <div id="searchSection" class="max-w-4xl mx-auto mb-12 bg-white/95 backdrop-blur-sm rounded-3xl p-8 shadow-2xl hidden">
            <div class="text-center mb-6">
                <h3 class="text-3xl font-bold text-purple-600 mb-2">üîç BUSCAR JOGOS</h3>
                <p class="text-gray-600">ENCONTRE O JOGO PERFEITO PARA VOC√ä!</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">PALAVRA-CHAVE:</label>
                    <input type="text" id="searchKeyword" placeholder="Digite aqui..." 
                           class="w-full p-3 border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:outline-none uppercase"
                           oninput="performSearch()">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">IDADE:</label>
                    <select id="searchAge" onchange="performSearch()" 
                            class="w-full p-3 border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:outline-none">
                        <option value="">TODAS AS IDADES</option>
                        <option value="1-3">1 A 3 ANOS</option>
                        <option value="4-6">4 A 6 ANOS</option>
                        <option value="7-9">7 A 9 ANOS</option>
                        <option value="10-14">10 A 14 ANOS</option>
                        <option value="naee">SALA DO NAEE</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">TIPO:</label>
                    <select id="searchType" onchange="performSearch()" 
                            class="w-full p-3 border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:outline-none">
                        <option value="">TODOS OS TIPOS</option>
                        <option value="matematica">MATEM√ÅTICA</option>
                        <option value="portugues">PORTUGU√äS</option>
                        <option value="ciencias">CI√äNCIAS</option>
                        <option value="cores">CORES E FORMAS</option>
                        <option value="coordenacao">COORDENA√á√ÉO</option>
                        <option value="comunicacao">COMUNICA√á√ÉO</option>
                        <option value="sensorial">SENSORIAL</option>
                        <option value="rotina">ROTINA</option>
                    </select>
                </div>
            </div>
            
            <div class="flex justify-center space-x-4">
                <button onclick="clearSearch()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full transition-colors">
                    üóëÔ∏è LIMPAR BUSCA
                </button>
                <button onclick="toggleSearch()" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-full transition-colors">
                    ‚Üê VOLTAR
                </button>
            </div>
            
            <!-- Search Results -->
            <div id="searchResults" class="mt-8 hidden">
                <h4 class="text-2xl font-bold text-purple-600 mb-4">RESULTADOS DA BUSCA:</h4>
                <div id="searchResultsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Search results will appear here -->
                </div>
            </div>
        </div>

        <!-- Search Toggle Button -->
        <div class="text-center mb-8">
            <button onclick="toggleSearch()" class="bg-white/90 hover:bg-white text-purple-600 font-bold py-4 px-8 rounded-full text-xl shadow-lg transition-colors">
                üîç BUSCAR JOGOS
            </button>
        </div>

        <!-- Capi Mascot -->
        <div id="capiContainer" class="fixed bottom-8 right-8 z-40">
            <div id="capiSpeech" class="speech-bubble hidden mb-4 max-w-xs">
                <p id="capiMessage" class="text-purple-800 font-semibold"></p>
            </div>
            
            <div id="capi" class="float cursor-pointer bg-orange-400 rounded-full p-4 shadow-2xl hover:bg-orange-500 transition-colors">
                <svg width="80" height="80" viewBox="0 0 100 100" class="text-white">
                    <!-- Corpo da Capivara -->
                    <ellipse cx="50" cy="60" rx="35" ry="25" fill="#8B4513"/>
                    <!-- Cabe√ßa -->
                    <ellipse cx="50" cy="35" rx="25" ry="20" fill="#A0522D"/>
                    <!-- Orelhas -->
                    <ellipse cx="35" cy="25" rx="8" ry="12" fill="#8B4513"/>
                    <ellipse cx="65" cy="25" rx="8" ry="12" fill="#8B4513"/>
                    <!-- Olhos -->
                    <circle cx="42" cy="32" r="4" fill="white"/>
                    <circle cx="58" cy="32" r="4" fill="white"/>
                    <circle cx="42" cy="32" r="2" fill="black"/>
                    <circle cx="58" cy="32" r="2" fill="black"/>
                    <!-- Nariz -->
                    <ellipse cx="50" cy="40" rx="3" ry="2" fill="black"/>
                    <!-- Boca -->
                    <path d="M 45 45 Q 50 48 55 45" stroke="black" stroke-width="2" fill="none"/>
                    <!-- Patas -->
                    <ellipse cx="35" cy="80" rx="6" ry="8" fill="#8B4513"/>
                    <ellipse cx="50" cy="80" rx="6" ry="8" fill="#8B4513"/>
                    <ellipse cx="65" cy="80" rx="6" ry="8" fill="#8B4513"/>
                </svg>
            </div>
        </div>

        <!-- Name Input Section -->
        <div id="nameSection" class="max-w-md mx-auto mb-12">
            <div class="bg-white/95 backdrop-blur-sm rounded-3xl p-8 shadow-2xl text-center">
                <div class="text-6xl mb-4">üëã</div>
                <h3 class="text-2xl font-bold text-purple-600 mb-6">OL√Å√Å√Å! QUAL √â O SEU NOME?</h3>
                
                <div class="mb-6">
                    <input 
                        type="text" 
                        id="playerName" 
                        placeholder="DIGITE SEU NOME AQUI"
                        class="w-full p-4 text-2xl font-bold text-center text-purple-800 bg-yellow-100 border-4 border-yellow-300 rounded-2xl focus:border-yellow-500 focus:outline-none placeholder-purple-400 uppercase"
                        maxlength="20"
                    >
                </div>
                
                <button 
                    id="startButton" 
                    onclick="startGame()" 
                    class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-2xl text-xl transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"
                    disabled
                >
                    üéÆ VAMOS JOGAR!
                </button>
                
                <p class="text-sm text-gray-600 mt-4 uppercase">PRECISO SABER SEU NOME PARA COME√áARMOS!</p>
            </div>
        </div>

        <!-- Age Groups Dashboard -->
        <div id="ageGroupsSection" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-8 mb-12 hidden">
            <!-- 1-3 anos -->
            <div class="age-card bg-white rounded-3xl p-6 shadow-xl" onclick="selectAgeGroup('1-3')">
                <div class="text-center">
                    <div class="text-6xl mb-4">üß∏</div>
                    <h3 class="text-2xl font-bold text-purple-600 mb-2">1 A 3 ANOS</h3>
                    <p class="text-gray-600 mb-4">CORES E FORMAS</p>
                    <div class="bg-red-100 rounded-2xl p-4">
                        <p class="text-red-800 font-semibold text-sm">EXPLORA√á√ÉO SENSORIAL</p>
                        <p class="text-red-600 text-xs mt-1">RECONHECIMENTO B√ÅSICO</p>
                    </div>
                </div>
            </div>

            <!-- 4-6 anos -->
            <div class="age-card bg-white rounded-3xl p-6 shadow-xl" onclick="selectAgeGroup('4-6')">
                <div class="text-center">
                    <div class="text-6xl mb-4">üß©</div>
                    <h3 class="text-2xl font-bold text-blue-600 mb-2">4 A 6 ANOS</h3>
                    <p class="text-gray-600 mb-4">LETRAS E N√öMEROS</p>
                    <div class="bg-blue-100 rounded-2xl p-4">
                        <p class="text-blue-800 font-semibold text-sm">ALFABETIZA√á√ÉO</p>
                        <p class="text-blue-600 text-xs mt-1">PRIMEIRAS PALAVRAS</p>
                    </div>
                </div>
            </div>

            <!-- 7-9 anos -->
            <div class="age-card bg-white rounded-3xl p-6 shadow-xl" onclick="selectAgeGroup('7-9')">
                <div class="text-center">
                    <div class="text-6xl mb-4">üö≤</div>
                    <h3 class="text-2xl font-bold text-green-600 mb-2">7 A 9 ANOS</h3>
                    <p class="text-gray-600 mb-4">LEITURA E MATEM√ÅTICA</p>
                    <div class="bg-green-100 rounded-2xl p-4">
                        <p class="text-green-800 font-semibold text-sm">RACIOC√çNIO L√ìGICO</p>
                        <p class="text-green-600 text-xs mt-1">RESOLU√á√ÉO DE PROBLEMAS</p>
                    </div>
                </div>
            </div>

            <!-- 10-14 anos -->
            <div class="age-card bg-white rounded-3xl p-6 shadow-xl" onclick="selectAgeGroup('10-14')">
                <div class="text-center">
                    <div class="text-6xl mb-4">üéÆ</div>
                    <h3 class="text-2xl font-bold text-purple-600 mb-2">10 A 14 ANOS</h3>
                    <p class="text-gray-600 mb-4">CI√äNCIAS E CULTURA</p>
                    <div class="bg-purple-100 rounded-2xl p-4">
                        <p class="text-purple-800 font-semibold text-sm">PENSAMENTO CR√çTICO</p>
                        <p class="text-purple-600 text-xs mt-1">PROJETOS AVAN√áADOS</p>
                    </div>
                </div>
            </div>

            <!-- SALA DO NAEE -->
            <div class="age-card bg-gradient-to-br from-orange-400 to-pink-500 rounded-3xl p-6 shadow-xl border-4 border-yellow-300" onclick="selectAgeGroup('naee')">
                <div class="text-center">
                    <div class="text-6xl mb-4">üåü</div>
                    <h3 class="text-2xl font-bold text-white mb-2">SALA DO NAEE</h3>
                    <p class="text-white/90 mb-4 font-semibold">EDUCA√á√ÉO ESPECIAL</p>
                    <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-4">
                        <p class="text-white font-semibold text-sm">JOGOS ADAPTADOS</p>
                        <p class="text-white/90 text-xs mt-1">INCLUS√ÉO E ACESSIBILIDADE</p>
                    </div>
                    <div class="mt-3 flex justify-center space-x-1">
                        <span class="text-lg">‚ôø</span>
                        <span class="text-lg">ü§ù</span>
                        <span class="text-lg">üíù</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Games Section -->
        <div id="gamesSection" class="hidden">
            <div class="bg-white/90 backdrop-blur-sm rounded-3xl p-8 shadow-2xl">
                <div class="flex items-center justify-between mb-6">
                    <h3 id="gamesSectionTitle" class="text-3xl font-bold text-purple-600"></h3>
                    <button onclick="backToDashboard()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full">
                        ‚Üê VOLTAR
                    </button>
                </div>
                
                <div id="gamesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Games will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Game Modal -->
        <div id="gameModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
            <div class="bg-white rounded-3xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl">
                <div class="bg-gradient-to-r from-purple-500 to-pink-500 p-6 text-white">
                    <div class="flex items-center justify-between">
                        <h3 id="gameTitle" class="text-2xl font-bold"></h3>
                        <button onclick="closeGame()" class="bg-white/20 hover:bg-white/30 rounded-full p-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="gameContent" class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                    <!-- Game content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Update Modal -->
        <div id="updateModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
            <div class="bg-white rounded-3xl max-w-2xl w-full shadow-2xl">
                <div class="bg-gradient-to-r from-green-500 to-emerald-600 p-6 text-white rounded-t-3xl">
                    <div class="flex items-center justify-between">
                        <h3 class="text-2xl font-bold">üîÑ ATUALIZA√á√ÉO DE JOGOS</h3>
                        <button onclick="closeUpdateModal()" class="bg-white/20 hover:bg-white/30 rounded-full p-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="p-8">
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4">üöÄ</div>
                        <h4 class="text-2xl font-bold text-gray-800 mb-2">SISTEMA DE ATUALIZA√á√ÉO</h4>
                        <p class="text-gray-600">Conectando com o reposit√≥rio GitHub para buscar novos jogos</p>
                    </div>
                    
                    <div class="bg-blue-50 rounded-2xl p-6 mb-6">
                        <div class="flex items-center space-x-3 mb-4">
                            <span class="text-2xl">üìÇ</span>
                            <div>
                                <h5 class="font-bold text-blue-800">REPOSIT√ìRIO OFICIAL</h5>
                                <p class="text-blue-600 text-sm">github.com/educacaodigital/capigames</p>
                            </div>
                        </div>
                        
                        <div id="updateStatus" class="space-y-3">
                            <div class="flex items-center justify-between p-3 bg-white rounded-lg">
                                <span class="text-gray-700">Status da Conex√£o:</span>
                                <span id="connectionStatus" class="text-yellow-600 font-semibold">üîÑ VERIFICANDO...</span>
                            </div>
                            
                            <div class="flex items-center justify-between p-3 bg-white rounded-lg">
                                <span class="text-gray-700">√öltima Atualiza√ß√£o:</span>
                                <span id="lastUpdate" class="text-gray-600 font-semibold">NUNCA</span>
                            </div>
                            
                            <div class="flex items-center justify-between p-3 bg-white rounded-lg">
                                <span class="text-gray-700">Vers√£o Atual:</span>
                                <span id="currentVersion" class="text-gray-600 font-semibold">v1.0.0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <button id="updateButton" onclick="performUpdate()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-2xl text-lg transition-colors">
                            üîÑ BUSCAR E INSTALAR ATUALIZA√á√ïES
                        </button>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <button onclick="checkVersion()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                                üìã VERIFICAR VERS√ÉO
                            </button>
                            
                            <button onclick="viewChangelog()" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                                üìù VER NOVIDADES
                            </button>
                        </div>
                    </div>
                    
                    <div id="updateProgress" class="hidden mt-6">
                        <div class="bg-gray-200 rounded-full h-4 mb-2">
                            <div id="progressBar" class="bg-green-500 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <p id="progressText" class="text-center text-sm text-gray-600">Preparando atualiza√ß√£o...</p>
                    </div>
                    
                    <div class="mt-6 p-4 bg-yellow-100 rounded-lg">
                        <p class="text-yellow-800 text-sm font-semibold">‚ö†Ô∏è IMPORTANTE:</p>
                        <p class="text-yellow-700 text-sm mt-1">A atualiza√ß√£o substituir√° o arquivo atual. Certifique-se de ter uma conex√£o est√°vel com a internet.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Detail Modal -->
        <div id="gameDetailModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-60 hidden items-center justify-center p-4">
            <div class="bg-white rounded-3xl max-w-2xl w-full max-h-[80vh] overflow-hidden shadow-2xl">
                <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-6 text-white">
                    <div class="flex items-center justify-between">
                        <h3 id="detailGameTitle" class="text-2xl font-bold"></h3>
                        <button onclick="closeGameDetail()" class="bg-white/20 hover:bg-white/30 rounded-full p-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="gameDetailContent" class="p-6 overflow-y-auto max-h-[calc(80vh-120px)]">
                    <!-- Game details will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <script>
        let capiEnabled = true;
        let currentAgeGroup = null;
        let playerName = '';
        let searchActive = false;
        let updateInProgress = false;
        
        // GitHub repository configuration
        const GITHUB_REPO = 'educacaodigital/capigames';
        const GITHUB_API_URL = `https://api.github.com/repos/${GITHUB_REPO}`;
        const GITHUB_RAW_URL = `https://raw.githubusercontent.com/${GITHUB_REPO}/main/index.html`;
        
        // Version and update tracking
        let currentVersion = localStorage.getItem('capiGamesVersion') || 'v1.0.0';
        let lastUpdateCheck = localStorage.getItem('lastUpdateCheck') || null;
        
        const games = {
            '1-3': [
                {
                    title: 'CORES M√ÅGICAS',
                    description: 'TOQUE NAS CORES IGUAIS!',
                    icon: 'üåà',
                    type: 'cores',
                    content: createColorGame
                }
            ],
            '4-6': [
                {
                    title: 'CA√áA LETRAS',
                    description: 'ENCONTRE AS LETRAS DO ALFABETO!',
                    icon: 'üî§',
                    type: 'portugues',
                    content: createLetterGame
                }
            ],
            '7-9': [
                {
                    title: 'Quebra-Cabe√ßa Matem√°tico',
                    description: 'Resolva as opera√ß√µes e monte o quebra-cabe√ßa!',
                    icon: 'üßÆ',
                    type: 'matematica',
                    content: createMathGame
                }
            ],
            '10-14': [
                {
                    title: 'Laborat√≥rio de Ci√™ncias',
                    description: 'Experimente e descubra os segredos da natureza!',
                    icon: 'üî¨',
                    type: 'ciencias',
                    content: createScienceGame
                }
            ],
            'naee': [
                {
                    title: 'COMUNICA√á√ÉO VISUAL',
                    description: 'Jogos com s√≠mbolos e gestos para comunica√ß√£o!',
                    icon: 'üëã',
                    type: 'comunicacao',
                    content: createCommunicationGame
                },
                {
                    title: 'COORDENA√á√ÉO MOTORA',
                    description: 'Exerc√≠cios adaptados para desenvolvimento motor!',
                    icon: 'ü§≤',
                    type: 'coordenacao',
                    content: createMotorGame
                },
                {
                    title: 'RECONHECIMENTO SENSORIAL',
                    description: 'Est√≠mulos visuais e auditivos adaptados!',
                    icon: 'üëÅÔ∏è',
                    type: 'sensorial',
                    content: createSensoryGame
                },
                {
                    title: 'ROTINA E AUTONOMIA',
                    description: 'Atividades para desenvolver independ√™ncia!',
                    icon: '‚è∞',
                    type: 'rotina',
                    content: createRoutineGame
                }
            ]
        };

        const capiMessages = [
            "OI! EU SOU O CAPI! üêπ",
            "VAMOS APRENDER JUNTOS? üìö",
            "ESCOLHA SUA IDADE E VAMOS BRINCAR! üéÆ",
            "QUE LEGAL! VOC√ä EST√Å EXPLORANDO! üåü",
            "CONTINUE ASSIM, VOC√ä EST√Å INDO MUITO BEM! üëè",
            "LEMBRE-SE: ERRAR FAZ PARTE DO APRENDER! üí™"
        ];

        // Search Functions
        function toggleSearch() {
            const searchSection = document.getElementById('searchSection');
            const ageGroupsSection = document.getElementById('ageGroupsSection');
            const nameSection = document.getElementById('nameSection');
            
            if (searchActive) {
                searchSection.classList.add('hidden');
                if (playerName) {
                    ageGroupsSection.classList.remove('hidden');
                } else {
                    nameSection.classList.remove('hidden');
                }
                searchActive = false;
                showCapiMessage("VOLTOU PARA A TELA PRINCIPAL! üè†");
            } else {
                searchSection.classList.remove('hidden');
                ageGroupsSection.classList.add('hidden');
                nameSection.classList.add('hidden');
                searchActive = true;
                showCapiMessage("VAMOS BUSCAR JOGOS INCR√çVEIS! üîç");
            }
        }

        function performSearch() {
            const keyword = document.getElementById('searchKeyword').value.toUpperCase();
            const age = document.getElementById('searchAge').value;
            const type = document.getElementById('searchType').value;
            
            const searchResults = document.getElementById('searchResults');
            const searchResultsGrid = document.getElementById('searchResultsGrid');
            
            let allGames = [];
            
            // Collect all games
            Object.keys(games).forEach(category => {
                games[category].forEach(game => {
                    allGames.push({
                        ...game,
                        category: category
                    });
                });
            });
            
            // Filter games
            let filteredGames = allGames.filter(game => {
                let matchesKeyword = !keyword || 
                    game.title.toUpperCase().includes(keyword) || 
                    game.description.toUpperCase().includes(keyword);
                
                let matchesAge = !age || game.category === age;
                let matchesType = !type || game.type === type;
                
                return matchesKeyword && matchesAge && matchesType;
            });
            
            if (filteredGames.length === 0) {
                searchResultsGrid.innerHTML = `
                    <div class="col-span-full text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">üòî</div>
                        <p class="text-xl font-bold">NENHUM JOGO ENCONTRADO</p>
                        <p>Tente outros filtros ou palavras-chave!</p>
                    </div>
                `;
            } else {
                searchResultsGrid.innerHTML = filteredGames.map(game => `
                    <div class="game-preview cursor-pointer" onclick="openGameFromSearch('${game.category}', '${game.title}')" 
                         style="background: linear-gradient(135deg, ${game.color || '#667eea'} 0%, ${adjustColor(game.color || '#667eea', -20)} 100%)">
                        <div class="text-6xl mb-4">${game.icon}</div>
                        <h4 class="text-xl font-bold mb-2">${game.title}</h4>
                        <p class="text-sm opacity-90 mb-2">${game.description}</p>
                        <div class="text-xs bg-white/20 px-2 py-1 rounded-full">
                            ${getCategoryName(game.category)} ‚Ä¢ ${getTypeName(game.type)}
                        </div>
                    </div>
                `).join('');
                
                showCapiMessage(`ENCONTREI ${filteredGames.length} JOGOS PARA VOC√ä! üéØ`);
            }
            
            searchResults.classList.remove('hidden');
        }

        function openGameFromSearch(category, title) {
            const game = games[category].find(g => g.title === title);
            if (game) {
                openGame(game);
            }
        }

        function clearSearch() {
            document.getElementById('searchKeyword').value = '';
            document.getElementById('searchAge').value = '';
            document.getElementById('searchType').value = '';
            document.getElementById('searchResults').classList.add('hidden');
            showCapiMessage("BUSCA LIMPA! DIGITE NOVOS FILTROS! üßπ");
        }

        function getTypeName(type) {
            const types = {
                'matematica': 'Matem√°tica',
                'portugues': 'Portugu√™s',
                'ciencias': 'Ci√™ncias',
                'cores': 'Cores e Formas',
                'coordenacao': 'Coordena√ß√£o',
                'comunicacao': 'Comunica√ß√£o',
                'sensorial': 'Sensorial',
                'rotina': 'Rotina'
            };
            return types[type] || 'Geral';
        }

        // Update System Functions
        function checkForUpdates() {
            document.getElementById('updateModal').classList.remove('hidden');
            document.getElementById('updateModal').classList.add('flex');
            
            // Initialize update status
            document.getElementById('connectionStatus').textContent = 'üîÑ VERIFICANDO...';
            document.getElementById('connectionStatus').className = 'text-yellow-600 font-semibold';
            
            if (lastUpdateCheck) {
                const lastCheck = new Date(lastUpdateCheck);
                document.getElementById('lastUpdate').textContent = lastCheck.toLocaleDateString('pt-BR') + ' √†s ' + lastCheck.toLocaleTimeString('pt-BR');
            }
            
            document.getElementById('currentVersion').textContent = currentVersion;
            
            // Check GitHub connection and repository structure
            setTimeout(() => {
                checkGitHubConnection();
            }, 1500);
            
            showCapiMessage("VERIFICANDO REPOSIT√ìRIO COMPLETO NO GITHUB! üîç");
        }

        function closeUpdateModal() {
            if (updateInProgress) {
                if (!confirm('Uma atualiza√ß√£o est√° em andamento. Tem certeza que deseja cancelar?')) {
                    return;
                }
                updateInProgress = false;
            }
            
            document.getElementById('updateModal').classList.add('hidden');
            document.getElementById('updateModal').classList.remove('flex');
            document.getElementById('updateProgress').classList.add('hidden');
        }

        async function checkGitHubConnection() {
            try {
                // Check repository access and get file tree
                const response = await fetch(`${GITHUB_API_URL}/contents`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const files = await response.json();
                    const fileCount = files.length;
                    
                    document.getElementById('connectionStatus').textContent = `‚úÖ CONECTADO (${fileCount} arquivos)`;
                    document.getElementById('connectionStatus').className = 'text-green-600 font-semibold';
                    showCapiMessage(`REPOSIT√ìRIO ACESS√çVEL! ${fileCount} ARQUIVOS ENCONTRADOS! ‚úÖ`);
                } else {
                    throw new Error('Falha ao acessar reposit√≥rio');
                }
            } catch (error) {
                document.getElementById('connectionStatus').textContent = '‚ùå ERRO DE CONEX√ÉO';
                document.getElementById('connectionStatus').className = 'text-red-600 font-semibold';
                showCapiMessage("ERRO AO ACESSAR REPOSIT√ìRIO GITHUB! ‚ùå");
            }
        }

        async function performUpdate() {
            if (updateInProgress) {
                showCapiMessage("ATUALIZA√á√ÉO J√Å EM ANDAMENTO! ‚è≥");
                return;
            }
            
            // Confirm complete file replacement
            if (!confirm('‚ö†Ô∏è ATEN√á√ÉO!\n\nEsta opera√ß√£o ir√°:\n‚Ä¢ Baixar TODOS os arquivos do reposit√≥rio GitHub\n‚Ä¢ Substituir FISICAMENTE os arquivos locais\n‚Ä¢ Incluindo o pr√≥prio index.html\n\nDeseja continuar?')) {
                return;
            }
            
            updateInProgress = true;
            const updateButton = document.getElementById('updateButton');
            const progressDiv = document.getElementById('updateProgress');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            updateButton.disabled = true;
            updateButton.textContent = '‚è≥ BAIXANDO REPOSIT√ìRIO...';
            progressDiv.classList.remove('hidden');
            
            try {
                // Step 1: Get repository file structure
                progressBar.style.width = '10%';
                progressText.textContent = 'Analisando estrutura do reposit√≥rio...';
                showCapiMessage("MAPEANDO TODOS OS ARQUIVOS DO REPOSIT√ìRIO... üìÇ");
                
                const repoResponse = await fetch(`${GITHUB_API_URL}/contents`, {
                    headers: { 'Accept': 'application/vnd.github.v3+json' }
                });
                
                if (!repoResponse.ok) {
                    throw new Error('Falha ao acessar reposit√≥rio');
                }
                
                const files = await repoResponse.json();
                const downloadableFiles = files.filter(file => file.type === 'file');
                
                progressBar.style.width = '20%';
                progressText.textContent = `Encontrados ${downloadableFiles.length} arquivos para download...`;
                
                // Step 2: Download all files
                const downloadedFiles = [];
                let downloadedCount = 0;
                
                for (const file of downloadableFiles) {
                    progressBar.style.width = `${20 + (downloadedCount / downloadableFiles.length) * 60}%`;
                    progressText.textContent = `Baixando: ${file.name} (${downloadedCount + 1}/${downloadableFiles.length})`;
                    
                    try {
                        const fileResponse = await fetch(file.download_url);
                        if (fileResponse.ok) {
                            const content = await fileResponse.text();
                            downloadedFiles.push({
                                name: file.name,
                                path: file.path,
                                content: content,
                                size: file.size
                            });
                            
                            showCapiMessage(`BAIXADO: ${file.name} ‚úÖ`);
                        } else {
                            console.warn(`Falha ao baixar: ${file.name}`);
                        }
                    } catch (error) {
                        console.warn(`Erro ao baixar ${file.name}:`, error);
                    }
                    
                    downloadedCount++;
                    await new Promise(resolve => setTimeout(resolve, 100)); // Small delay
                }
                
                // Step 3: Validate downloads
                progressBar.style.width = '85%';
                progressText.textContent = 'Validando arquivos baixados...';
                
                const indexFile = downloadedFiles.find(f => f.name === 'index.html');
                if (!indexFile || !indexFile.content.includes('CAPI GAMES')) {
                    throw new Error('Arquivo index.html inv√°lido ou n√£o encontrado');
                }
                
                // Step 4: Create file system operations
                progressBar.style.width = '95%';
                progressText.textContent = 'Preparando substitui√ß√£o de arquivos...';
                
                // Create download links for all files
                const fileOperations = downloadedFiles.map(file => {
                    const blob = new Blob([file.content], { type: getFileType(file.name) });
                    const url = URL.createObjectURL(blob);
                    return {
                        name: file.name,
                        url: url,
                        size: file.size
                    };
                });
                
                // Step 5: Complete update
                progressBar.style.width = '100%';
                progressText.textContent = 'Atualiza√ß√£o conclu√≠da! Preparando downloads...';
                
                // Update version info
                const newVersion = `v${new Date().toISOString().split('T')[0]}`;
                localStorage.setItem('capiGamesVersion', newVersion);
                localStorage.setItem('lastUpdateCheck', new Date().toISOString());
                
                showCapiMessage("TODOS OS ARQUIVOS BAIXADOS! INICIANDO DOWNLOADS... üì•");
                
                // Show download instructions
                setTimeout(() => {
                    showDownloadInstructions(fileOperations, downloadedFiles.length);
                }, 1000);
                
            } catch (error) {
                console.error('Update failed:', error);
                progressBar.style.width = '0%';
                progressText.textContent = 'Erro na atualiza√ß√£o: ' + error.message;
                progressBar.className = 'bg-red-500 h-4 rounded-full transition-all duration-300';
                
                showCapiMessage("ERRO NO DOWNLOAD! VERIFIQUE SUA CONEX√ÉO! ‚ùå");
                
                updateButton.disabled = false;
                updateButton.textContent = 'üîÑ BUSCAR E INSTALAR ATUALIZA√á√ïES';
                
                setTimeout(() => {
                    progressDiv.classList.add('hidden');
                    progressBar.className = 'bg-green-500 h-4 rounded-full transition-all duration-300';
                }, 3000);
            }
            
            updateInProgress = false;
        }

        function getFileType(filename) {
            const extension = filename.split('.').pop().toLowerCase();
            const types = {
                'html': 'text/html',
                'css': 'text/css',
                'js': 'application/javascript',
                'json': 'application/json',
                'txt': 'text/plain',
                'md': 'text/markdown',
                'png': 'image/png',
                'jpg': 'image/jpeg',
                'jpeg': 'image/jpeg',
                'gif': 'image/gif',
                'svg': 'image/svg+xml'
            };
            return types[extension] || 'application/octet-stream';
        }

        function showDownloadInstructions(fileOperations, totalFiles) {
            const modal = document.getElementById('updateModal');
            const modalContent = modal.querySelector('.p-8');
            
            modalContent.innerHTML = `
                <div class="text-center mb-8">
                    <div class="text-6xl mb-4">üì•</div>
                    <h4 class="text-2xl font-bold text-gray-800 mb-2">DOWNLOAD COMPLETO</h4>
                    <p class="text-gray-600">Todos os ${totalFiles} arquivos foram baixados com sucesso!</p>
                </div>
                
                <div class="bg-green-50 rounded-2xl p-6 mb-6">
                    <h5 class="font-bold text-green-800 mb-4">üìã INSTRU√á√ïES PARA ATUALIZA√á√ÉO:</h5>
                    <ol class="text-green-700 space-y-2 text-sm">
                        <li><strong>1.</strong> Clique em "BAIXAR TODOS OS ARQUIVOS" abaixo</li>
                        <li><strong>2.</strong> Extraia os arquivos baixados</li>
                        <li><strong>3.</strong> Substitua os arquivos na pasta raiz do projeto</li>
                        <li><strong>4.</strong> O index.html ser√° substitu√≠do automaticamente</li>
                        <li><strong>5.</strong> Recarregue a p√°gina para ver as atualiza√ß√µes</li>
                    </ol>
                </div>
                
                <div class="space-y-4">
                    <button onclick="downloadAllFiles()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-2xl text-lg transition-colors">
                        üì• BAIXAR TODOS OS ARQUIVOS (${totalFiles} arquivos)
                    </button>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="downloadFileByFile()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                            üìÑ BAIXAR UM POR VEZ
                        </button>
                        
                        <button onclick="showFileList()" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                            üìã VER LISTA DE ARQUIVOS
                        </button>
                    </div>
                    
                    <button onclick="closeUpdateModal()" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                        ‚úñÔ∏è FECHAR
                    </button>
                </div>
                
                <div class="mt-6 p-4 bg-yellow-100 rounded-lg">
                    <p class="text-yellow-800 text-sm font-semibold">‚ö†Ô∏è IMPORTANTE:</p>
                    <p class="text-yellow-700 text-sm mt-1">Ap√≥s substituir os arquivos, recarregue completamente a p√°gina (Ctrl+F5) para aplicar todas as mudan√ßas.</p>
                </div>
            `;
            
            // Store file operations globally for download functions
            window.pendingFileOperations = fileOperations;
        }

        function downloadAllFiles() {
            if (!window.pendingFileOperations) {
                showCapiMessage("ERRO: ARQUIVOS N√ÉO ENCONTRADOS! ‚ùå");
                return;
            }
            
            showCapiMessage("INICIANDO DOWNLOAD DE TODOS OS ARQUIVOS... üì•");
            
            // Create a zip-like download experience by downloading all files
            window.pendingFileOperations.forEach((file, index) => {
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.href = file.url;
                    link.download = file.name;
                    link.style.display = 'none';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    if (index === window.pendingFileOperations.length - 1) {
                        showCapiMessage("TODOS OS ARQUIVOS BAIXADOS! SUBSTITUA NA PASTA RAIZ! üéâ");
                    }
                }, index * 500); // Stagger downloads
            });
        }

        function downloadFileByFile() {
            if (!window.pendingFileOperations) {
                showCapiMessage("ERRO: ARQUIVOS N√ÉO ENCONTRADOS! ‚ùå");
                return;
            }
            
            let currentIndex = 0;
            
            function downloadNext() {
                if (currentIndex >= window.pendingFileOperations.length) {
                    showCapiMessage("TODOS OS DOWNLOADS CONCLU√çDOS! üéâ");
                    return;
                }
                
                const file = window.pendingFileOperations[currentIndex];
                const link = document.createElement('a');
                link.href = file.url;
                link.download = file.name;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showCapiMessage(`BAIXADO: ${file.name} (${currentIndex + 1}/${window.pendingFileOperations.length}) üìÑ`);
                
                currentIndex++;
                setTimeout(downloadNext, 1000);
            }
            
            downloadNext();
        }

        function showFileList() {
            if (!window.pendingFileOperations) {
                showCapiMessage("ERRO: LISTA N√ÉO ENCONTRADA! ‚ùå");
                return;
            }
            
            const fileList = window.pendingFileOperations.map(file => 
                `‚Ä¢ ${file.name} (${(file.size / 1024).toFixed(1)} KB)`
            ).join('\n');
            
            alert(`üìã ARQUIVOS PARA DOWNLOAD:\n\n${fileList}\n\nTotal: ${window.pendingFileOperations.length} arquivos`);
        }

        function extractVersionFromContent(content) {
            // Try to extract version from content
            const versionMatch = content.match(/version["\s]*[:=]["\s]*([v]?[\d.]+)/i);
            return versionMatch ? versionMatch[1] : null;
        }

        async function checkVersion() {
            showCapiMessage("VERIFICANDO VERS√ÉO ATUAL... üìã");
            
            try {
                const response = await fetch(GITHUB_API_URL + '/releases/latest');
                if (response.ok) {
                    const release = await response.json();
                    const latestVersion = release.tag_name || 'Desconhecida';
                    
                    alert(`üìã INFORMA√á√ïES DE VERS√ÉO\n\nVers√£o Atual: ${currentVersion}\n√öltima Vers√£o: ${latestVersion}\n\nReposit√≥rio: ${GITHUB_REPO}`);
                    showCapiMessage(`VERS√ÉO ATUAL: ${currentVersion} | √öLTIMA: ${latestVersion} üìã`);
                } else {
                    throw new Error('N√£o foi poss√≠vel verificar a vers√£o');
                }
            } catch (error) {
                alert(`üìã INFORMA√á√ïES DE VERS√ÉO\n\nVers√£o Atual: ${currentVersion}\nStatus: Erro ao verificar vers√£o remota\n\nReposit√≥rio: ${GITHUB_REPO}`);
                showCapiMessage("ERRO AO VERIFICAR VERS√ÉO REMOTA! ‚ùå");
            }
        }

        async function viewChangelog() {
            showCapiMessage("CARREGANDO NOVIDADES... üìù");
            
            try {
                const response = await fetch(GITHUB_API_URL + '/releases');
                if (response.ok) {
                    const releases = await response.json();
                    const latest = releases[0] || {};
                    
                    const changelog = latest.body || 'Nenhuma informa√ß√£o de mudan√ßas dispon√≠vel.';
                    const version = latest.tag_name || 'Vers√£o desconhecida';
                    const date = latest.published_at ? new Date(latest.published_at).toLocaleDateString('pt-BR') : 'Data desconhecida';
                    
                    alert(`üìù NOVIDADES - ${version}\n\nData: ${date}\n\n${changelog}\n\nReposit√≥rio: ${GITHUB_REPO}`);
                    showCapiMessage("NOVIDADES CARREGADAS! üìù");
                } else {
                    throw new Error('N√£o foi poss√≠vel carregar as novidades');
                }
            } catch (error) {
                alert(`üìù NOVIDADES\n\nN√£o foi poss√≠vel carregar as informa√ß√µes de mudan√ßas do reposit√≥rio.\n\nReposit√≥rio: ${GITHUB_REPO}\nErro: ${error.message}`);
                showCapiMessage("ERRO AO CARREGAR NOVIDADES! ‚ùå");
            }
        }

        // Capi interactions
        document.getElementById('capi').addEventListener('click', function() {
            if (!capiEnabled) return;
            
            this.classList.add('dance');
            setTimeout(() => this.classList.remove('dance'), 1000);
            
            showCapiMessage(capiMessages[Math.floor(Math.random() * capiMessages.length)]);
        });

        document.getElementById('toggleCapi').addEventListener('click', function() {
            capiEnabled = !capiEnabled;
            const capiContainer = document.getElementById('capiContainer');
            const toggleText = document.getElementById('capiToggleText');
            
            if (capiEnabled) {
                capiContainer.style.display = 'block';
                toggleText.textContent = 'üêπ DESABILITAR CAPI';
                showCapiMessage("OBA! ESTOU DE VOLTA! üéâ");
            } else {
                capiContainer.style.display = 'none';
                toggleText.textContent = 'üêπ HABILITAR CAPI';
            }
        });

        function showCapiMessage(message) {
            if (!capiEnabled) return;
            
            const speech = document.getElementById('capiSpeech');
            const messageEl = document.getElementById('capiMessage');
            
            messageEl.textContent = message;
            speech.classList.remove('hidden');
            
            setTimeout(() => {
                speech.classList.add('hidden');
            }, 3000);
        }

        function selectAgeGroup(ageGroup) {
            currentAgeGroup = ageGroup;
            
            // Hide dashboard, show games
            document.querySelector('.grid').style.display = 'none';
            document.getElementById('gamesSection').classList.remove('hidden');
            
            // Update title
            const titles = {
                '1-3': 'JOGOS PARA 1 A 3 ANOS',
                '4-6': 'JOGOS PARA 4 A 6 ANOS',
                '7-9': 'Jogos para 7 a 9 anos',
                '10-14': 'Jogos para 10 a 14 anos',
                'naee': 'SALA DO NAEE - EDUCA√á√ÉO ESPECIAL'
            };
            
            document.getElementById('gamesSectionTitle').textContent = titles[ageGroup];
            
            // Load games
            loadGames(ageGroup);
            
            // Capi message
            const messages = {
                '1-3': `${playerName}, VAMOS BRINCAR COM CORES! üåà`,
                '4-6': `${playerName}, HORA DE APRENDER LETRAS! üìù`,
                '7-9': `${playerName}, QUE LEGAL! VAMOS RESOLVER PROBLEMAS JUNTOS! üß†`,
                '10-14': `${playerName}, EXCELENTE ESCOLHA! PREPARE-SE PARA DESAFIOS INCR√çVEIS! üöÄ`,
                'naee': `${playerName}, BEM-VINDO √Ä SALA DO NAEE! JOGOS ESPECIAIS PARA VOC√ä! üåü`
            };
            
            showCapiMessage(messages[ageGroup]);
        }

        function loadGames(ageGroup) {
            const gamesGrid = document.getElementById('gamesGrid');
            gamesGrid.innerHTML = '';
            
            games[ageGroup].forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'game-preview';
                
                // Use custom color if available
                if (game.color) {
                    gameCard.style.background = `linear-gradient(135deg, ${game.color} 0%, ${adjustColor(game.color, -20)} 100%)`;
                }
                
                gameCard.innerHTML = `
                    <div class="text-6xl mb-4">${game.icon}</div>
                    <h4 class="text-xl font-bold mb-2">${game.title}</h4>
                    <p class="text-sm opacity-90">${game.description}</p>
                    ${game.id ? '<div class="text-xs mt-2 bg-white/20 px-2 py-1 rounded-full">PERSONALIZADO</div>' : ''}
                `;
                
                gameCard.addEventListener('click', () => openGame(game));
                gamesGrid.appendChild(gameCard);
            });
        }

        function backToDashboard() {
            document.getElementById('gamesSection').classList.add('hidden');
            document.querySelector('.grid').style.display = 'grid';
            showCapiMessage("ESCOLHA OUTRA IDADE SE QUISER! üòä");
        }

        function openGame(game) {
            document.getElementById('gameTitle').textContent = game.title;
            document.getElementById('gameContent').innerHTML = '';
            
            // Load game content
            game.content(document.getElementById('gameContent'));
            
            document.getElementById('gameModal').classList.remove('hidden');
            document.getElementById('gameModal').classList.add('flex');
            
            showCapiMessage("DIVIRTA-SE JOGANDO! üéÆ");
        }

        function closeGame() {
            document.getElementById('gameModal').classList.add('hidden');
            document.getElementById('gameModal').classList.remove('flex');
        }

        // Game creation functions (without scoring systems)
        function createColorGame(container) {
            const colors = ['üî¥', 'üü°', 'üü¢', 'üîµ', 'üü£', 'üü†'];
            let targetColor = colors[Math.floor(Math.random() * colors.length)];
            
            container.innerHTML = `
                <div class="text-center">
                    <h4 class="text-3xl font-bold text-purple-600 mb-4">ENCONTRE A COR:</h4>
                    <div class="text-8xl mb-6">${targetColor}</div>
                    <div class="grid grid-cols-3 gap-4 max-w-md mx-auto">
                        ${colors.map(color => `
                            <button class="text-6xl p-4 rounded-2xl bg-gray-100 hover:bg-gray-200 transition-colors" 
                                    onclick="checkColor('${color}', '${targetColor}')">
                                ${color}
                            </button>
                        `).join('')}
                    </div>
                    <div id="colorResult" class="mt-6 text-2xl font-bold"></div>
                </div>
            `;
        }

        function createLetterGame(container) {
            const letters = ['A', 'B', 'C', 'D', 'E', 'F'];
            let targetLetter = letters[Math.floor(Math.random() * letters.length)];
            
            container.innerHTML = `
                <div class="text-center">
                    <h4 class="text-2xl font-bold text-blue-600 mb-4">ENCONTRE A LETRA:</h4>
                    <div class="text-8xl mb-6 font-bold text-blue-800">${targetLetter}</div>
                    <div class="grid grid-cols-3 gap-4 max-w-md mx-auto">
                        ${letters.map(letter => `
                            <button class="text-4xl font-bold p-4 rounded-2xl bg-blue-100 hover:bg-blue-200 transition-colors text-blue-800" 
                                    onclick="checkLetter('${letter}', '${targetLetter}')">
                                ${letter}
                            </button>
                        `).join('')}
                    </div>
                    <div id="letterResult" class="mt-6 text-xl font-bold"></div>
                </div>
            `;
        }

        function createMathGame(container) {
            const num1 = Math.floor(Math.random() * 10) + 1;
            const num2 = Math.floor(Math.random() * 10) + 1;
            const correctAnswer = num1 + num2;
            const wrongAnswers = [correctAnswer + 1, correctAnswer - 1, correctAnswer + 2].filter(n => n > 0);
            const allAnswers = [correctAnswer, ...wrongAnswers.slice(0, 2)].sort(() => Math.random() - 0.5);
            
            container.innerHTML = `
                <div class="text-center">
                    <h4 class="text-2xl font-bold text-green-600 mb-4">RESOLVA A OPERA√á√ÉO:</h4>
                    <div class="text-6xl mb-6 font-bold text-green-800">${num1} + ${num2} = ?</div>
                    <div class="grid grid-cols-3 gap-4 max-w-md mx-auto">
                        ${allAnswers.map(answer => `
                            <button class="text-3xl font-bold p-4 rounded-2xl bg-green-100 hover:bg-green-200 transition-colors text-green-800" 
                                    onclick="checkMath(${answer}, ${correctAnswer})">
                                ${answer}
                            </button>
                        `).join('')}
                    </div>
                    <div id="mathResult" class="mt-6 text-xl font-bold"></div>
                </div>
            `;
        }

        function createScienceGame(container) {
            const experiments = [
                { question: "O que acontece quando misturamos √°gua e √≥leo?", answer: "Eles n√£o se misturam", options: ["Eles se misturam completamente", "Eles n√£o se misturam", "Eles viram gelo"] },
                { question: "Qual √© o estado da √°gua a 100¬∞C?", answer: "Vapor", options: ["L√≠quido", "S√≥lido", "Vapor"] },
                { question: "O que as plantas precisam para fazer fotoss√≠ntese?", answer: "Luz solar", options: ["Apenas √°gua", "Luz solar", "Apenas terra"] }
            ];
            
            const experiment = experiments[Math.floor(Math.random() * experiments.length)];
            
            container.innerHTML = `
                <div class="text-center">
                    <h4 class="text-2xl font-bold text-purple-600 mb-4">EXPERIMENTO CIENT√çFICO</h4>
                    <div class="text-4xl mb-4">üî¨</div>
                    <p class="text-lg mb-6 text-gray-700">${experiment.question}</p>
                    <div class="space-y-3 max-w-md mx-auto">
                        ${experiment.options.map(option => `
                            <button class="w-full text-left p-4 rounded-2xl bg-purple-100 hover:bg-purple-200 transition-colors text-purple-800 font-semibold" 
                                    onclick="checkScience('${option}', '${experiment.answer}')">
                                ${option}
                            </button>
                        `).join('')}
                    </div>
                    <div id="scienceResult" class="mt-6 text-xl font-bold"></div>
                </div>
            `;
        }

        // Game check functions (without scoring)
        function checkColor(selected, target) {
            const result = document.getElementById('colorResult');
            if (selected === target) {
                result.innerHTML = '<span class="text-green-600">üéâ MUITO BEM!</span>';
                showCapiMessage(`PARAB√âNS ${playerName}! VOC√ä ACERTOU! üåü`);
            } else {
                result.innerHTML = '<span class="text-orange-600">TENTE NOVAMENTE!</span>';
                showCapiMessage(`${playerName}, QUASE L√Å! TENTA DE NOVO! üí™`);
            }
        }

        function checkLetter(selected, target) {
            const result = document.getElementById('letterResult');
            if (selected === target) {
                result.innerHTML = '<span class="text-green-600">üéâ EXCELENTE!</span>';
                showCapiMessage(`${playerName}, ISSO A√ç! VOC√ä CONHECE AS LETRAS! üìö`);
            } else {
                result.innerHTML = '<span class="text-orange-600">TENTE OUTRA VEZ!</span>';
                showCapiMessage(`${playerName}, BOA TENTATIVA! VAMOS TENTAR MAIS UMA VEZ! üéØ`);
            }
        }

        function checkMath(selected, correct) {
            const result = document.getElementById('mathResult');
            if (selected === correct) {
                result.innerHTML = '<span class="text-green-600">üéâ Perfeito! Voc√™ √© um matem√°tico!</span>';
                showCapiMessage("Incr√≠vel! Voc√™ domina a matem√°tica! üßÆ");
            } else {
                result.innerHTML = '<span class="text-orange-600">Quase! Pense um pouco mais...</span>';
                showCapiMessage("Boa tentativa! A matem√°tica √© sobre praticar! üí°");
            }
        }

        function checkScience(selected, correct) {
            const result = document.getElementById('scienceResult');
            if (selected === correct) {
                result.innerHTML = '<span class="text-green-600">üéâ Excelente! Voc√™ √© um cientista!</span>';
                showCapiMessage("Fant√°stico! Continue explorando a ci√™ncia! üî¨");
            } else {
                result.innerHTML = '<span class="text-orange-600">Interessante hip√≥tese! Que tal tentar outra?</span>';
                showCapiMessage("√ìtima reflex√£o! A ci√™ncia √© sobre experimentar! üß™");
            }
        }

        // NAEE Games Functions
        function createCommunicationGame(container) {
            const symbols = [
                { emoji: 'üòä', word: 'FELIZ', sound: 'Feliz!' },
                { emoji: 'üò¢', word: 'TRISTE', sound: 'Triste!' },
                { emoji: 'üçé', word: 'MA√á√É', sound: 'Ma√ß√£!' },
                { emoji: 'üíß', word: '√ÅGUA', sound: '√Ågua!' }
            ];
            
            const targetSymbol = symbols[Math.floor(Math.random() * symbols.length)];
            
            container.innerHTML = `
                <div class="text-center">
                    <h4 class="text-3xl font-bold text-orange-600 mb-6">COMUNICA√á√ÉO VISUAL</h4>
                    <div class="bg-yellow-100 rounded-3xl p-8 mb-6">
                        <p class="text-2xl font-bold text-orange-800 mb-4">ENCONTRE O S√çMBOLO:</p>
                        <div class="text-9xl mb-4">${targetSymbol.emoji}</div>
                        <p class="text-3xl font-bold text-orange-700">${targetSymbol.word}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-6 max-w-lg mx-auto">
                        ${symbols.map(symbol => `
                            <button class="bg-white hover:bg-orange-50 border-4 border-orange-200 hover:border-orange-400 rounded-3xl p-6 transition-all transform hover:scale-105" 
                                    onclick="checkCommunication('${symbol.emoji}', '${targetSymbol.emoji}', '${symbol.sound}')">
                                <div class="text-6xl mb-2">${symbol.emoji}</div>
                                <p class="text-xl font-bold text-orange-700">${symbol.word}</p>
                            </button>
                        `).join('')}
                    </div>
                    <div id="communicationResult" class="mt-6 text-2xl font-bold"></div>
                </div>
            `;
        }

        function createMotorGame(container) {
            container.innerHTML = `
                <div class="text-center">
                    <h4 class="text-3xl font-bold text-pink-600 mb-6">COORDENA√á√ÉO MOTORA</h4>
                    <div class="bg-pink-100 rounded-3xl p-8 mb-6">
                        <p class="text-2xl font-bold text-pink-800 mb-4">SIGA OS MOVIMENTOS:</p>
                        <div id="motorTarget" class="text-8xl mb-4">üëã</div>
                        <p class="text-xl text-pink-700">ACENE COM A M√ÉO!</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-6 max-w-lg mx-auto">
                        <button class="bg-white hover:bg-pink-50 border-4 border-pink-200 hover:border-pink-400 rounded-3xl p-8 transition-all transform hover:scale-105" 
                                onclick="performMotorAction('wave')">
                            <div class="text-6xl mb-2">üëã</div>
                            <p class="text-xl font-bold text-pink-700">ACENAR</p>
                        </button>
                        
                        <button class="bg-white hover:bg-pink-50 border-4 border-pink-200 hover:border-pink-400 rounded-3xl p-8 transition-all transform hover:scale-105" 
                                onclick="performMotorAction('clap')">
                            <div class="text-6xl mb-2">üëè</div>
                            <p class="text-xl font-bold text-pink-700">BATER PALMAS</p>
                        </button>
                        
                        <button class="bg-white hover:bg-pink-50 border-4 border-pink-200 hover:border-pink-400 rounded-3xl p-8 transition-all transform hover:scale-105" 
                                onclick="performMotorAction('point')">
                            <div class="text-6xl mb-2">üëâ</div>
                            <p class="text-xl font-bold text-pink-700">APONTAR</p>
                        </button>
                        
                        <button class="bg-white hover:bg-pink-50 border-4 border-pink-200 hover:border-pink-400 rounded-3xl p-8 transition-all transform hover:scale-105" 
                                onclick="performMotorAction('thumbs')">
                            <div class="text-6xl mb-2">üëç</div>
                            <p class="text-xl font-bold text-pink-700">JOINHA</p>
                        </button>
                    </div>
                    <div id="motorResult" class="mt-6 text-2xl font-bold"></div>
                </div>
            `;
        }

        function createSensoryGame(container) {
            const colors = ['üî¥', 'üü°', 'üîµ', 'üü¢'];
            const shapes = ['‚≠ê', '‚ù§Ô∏è', 'üî∑', 'üî∂'];
            
            container.innerHTML = `
                <div class="text-center">
                    <h4 class="text-3xl font-bold text-indigo-600 mb-6">RECONHECIMENTO SENSORIAL</h4>
                    <div class="bg-indigo-100 rounded-3xl p-8 mb-6">
                        <p class="text-2xl font-bold text-indigo-800 mb-4">TOQUE NAS CORES:</p>
                        <div class="grid grid-cols-2 gap-4 max-w-md mx-auto">
                            ${colors.map(color => `
                                <button class="text-8xl p-6 bg-white rounded-3xl border-4 border-indigo-200 hover:border-indigo-400 transition-all transform hover:scale-110" 
                                        onclick="touchSensory('${color}')">
                                    ${color}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="bg-purple-100 rounded-3xl p-8">
                        <p class="text-2xl font-bold text-purple-800 mb-4">TOQUE NAS FORMAS:</p>
                        <div class="grid grid-cols-2 gap-4 max-w-md mx-auto">
                            ${shapes.map(shape => `
                                <button class="text-8xl p-6 bg-white rounded-3xl border-4 border-purple-200 hover:border-purple-400 transition-all transform hover:scale-110" 
                                        onclick="touchSensory('${shape}')">
                                    ${shape}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    <div id="sensoryResult" class="mt-6 text-2xl font-bold"></div>
                </div>
            `;
        }

        function createRoutineGame(container) {
            const routines = [
                { icon: 'ü¶∑', action: 'ESCOVAR OS DENTES', time: 'MANH√É' },
                { icon: 'üçΩÔ∏è', action: 'ALMO√áAR', time: 'MEIO-DIA' },
                { icon: 'üõÅ', action: 'TOMAR BANHO', time: 'NOITE' },
                { icon: 'üò¥', action: 'DORMIR', time: 'NOITE' }
            ];
            
            container.innerHTML = `
                <div class="text-center">
                    <h4 class="text-3xl font-bold text-teal-600 mb-6">ROTINA E AUTONOMIA</h4>
                    <div class="bg-teal-100 rounded-3xl p-8 mb-6">
                        <p class="text-2xl font-bold text-teal-800 mb-6">ORGANIZE SUA ROTINA:</p>
                        <div class="grid grid-cols-1 gap-4 max-w-lg mx-auto">
                            ${routines.map((routine, index) => `
                                <div class="bg-white rounded-2xl p-6 border-4 border-teal-200 hover:border-teal-400 transition-all cursor-pointer" 
                                     onclick="selectRoutine(${index})">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <span class="text-4xl">${routine.icon}</span>
                                            <div class="text-left">
                                                <p class="text-xl font-bold text-teal-700">${routine.action}</p>
                                                <p class="text-lg text-teal-600">${routine.time}</p>
                                            </div>
                                        </div>
                                        <div class="text-3xl text-teal-400">‚úì</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div id="routineResult" class="mt-6 text-2xl font-bold"></div>
                </div>
            `;
        }

        // NAEE Game Check Functions
        function checkCommunication(selected, target, sound) {
            const result = document.getElementById('communicationResult');
            if (selected === target) {
                result.innerHTML = '<span class="text-green-600">üéâ MUITO BEM! COMUNICA√á√ÉO PERFEITA!</span>';
                showCapiMessage(`EXCELENTE ${playerName}! VOC√ä SE COMUNICOU MUITO BEM! üëè`);
            } else {
                result.innerHTML = '<span class="text-orange-600">CONTINUE TENTANDO! VOC√ä CONSEGUE!</span>';
                showCapiMessage(`${playerName}, TENTE NOVAMENTE! CADA TENTATIVA √â UM APRENDIZADO! üí™`);
            }
        }

        function performMotorAction(action) {
            const result = document.getElementById('motorResult');
            const target = document.getElementById('motorTarget');
            
            const actions = {
                'wave': { emoji: 'üëã', message: 'ACENANDO!' },
                'clap': { emoji: 'üëè', message: 'BATENDO PALMAS!' },
                'point': { emoji: 'üëâ', message: 'APONTANDO!' },
                'thumbs': { emoji: 'üëç', message: 'JOINHA!' }
            };
            
            target.textContent = actions[action].emoji;
            result.innerHTML = `<span class="text-green-600">üéâ ${actions[action].message}</span>`;
            showCapiMessage(`√ìTIMO MOVIMENTO ${playerName}! CONTINUE PRATICANDO! ü§≤`);
        }

        function touchSensory(item) {
            const result = document.getElementById('sensoryResult');
            result.innerHTML = '<span class="text-green-600">üéâ √ìTIMO TOQUE! VOC√ä RECONHECEU!</span>';
            showCapiMessage(`PERFEITO ${playerName}! SEUS SENTIDOS EST√ÉO FUNCIONANDO MUITO BEM! üëÅÔ∏è`);
        }

        function selectRoutine(index) {
            const result = document.getElementById('routineResult');
            const routines = ['MANH√É', 'MEIO-DIA', 'NOITE', 'NOITE'];
            result.innerHTML = `<span class="text-green-600">üéâ ROTINA ORGANIZADA! HORA DE ${routines[index]}!</span>`;
            showCapiMessage(`MUITO BOM ${playerName}! VOC√ä EST√Å ORGANIZANDO SUA ROTINA! ‚è∞`);
        }

        // Name input functionality
        document.getElementById('playerName').addEventListener('input', function(e) {
            // Convert to uppercase
            e.target.value = e.target.value.toUpperCase();
            
            // Enable/disable start button
            const startButton = document.getElementById('startButton');
            if (e.target.value.trim().length >= 2) {
                startButton.disabled = false;
                startButton.classList.remove('disabled:bg-gray-400', 'disabled:cursor-not-allowed');
            } else {
                startButton.disabled = true;
                startButton.classList.add('disabled:bg-gray-400', 'disabled:cursor-not-allowed');
            }
        });

        // Enter key to start game
        document.getElementById('playerName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !document.getElementById('startButton').disabled) {
                startGame();
            }
        });

        function startGame() {
            const nameInput = document.getElementById('playerName');
            playerName = nameInput.value.trim();
            
            if (playerName.length < 2) {
                showCapiMessage("PRECISO SABER SEU NOME PRIMEIRO! üòä");
                return;
            }
            
            // Hide name section, show age groups
            document.getElementById('nameSection').classList.add('hidden');
            document.getElementById('ageGroupsSection').classList.remove('hidden');
            
            // Personalized Capi greeting
            showCapiMessage(`OL√Å ${playerName}! ESCOLHA SUA IDADE PARA COME√áAR! üéÆ`);
        }

        function getCategoryName(category) {
            const names = {
                '1-3': 'Creche',
                '4-6': 'Infantil',
                '7-9': 'Fund. I',
                '10-14': 'Fund. II',
                'naee': 'NAEE'
            };
            return names[category] || category;
        }

        // Initial Capi greeting and system initialization
        setTimeout(() => {
            showCapiMessage("OL√Å! BEM-VINDOS AO CAPI GAMES! üéÆ");
            
            // Check for automatic updates on startup
            if (lastUpdateCheck) {
                const daysSinceUpdate = Math.floor((Date.now() - new Date(lastUpdateCheck).getTime()) / (1000 * 60 * 60 * 24));
                if (daysSinceUpdate >= 7) {
                    showCapiMessage("VERIFICANDO ATUALIZA√á√ïES AUTOM√ÅTICAS... üîÑ");
                    setTimeout(() => {
                        checkGitHubConnection();
                    }, 3000);
                }
            }
        }, 1000);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98c8e23ab33e8b17',t:'MTc2MDEyODMxMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

