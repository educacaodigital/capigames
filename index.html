<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CAPIGAMES</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Manifesto local OBRIGAT√ìRIO (gerado pelo generate-manifest.vbs) -->
  <script src="games-manifest.js" defer></script>

  <style>
    :root{
      --grad: linear-gradient(135deg,#7c4dff 0%, #8e2de2 40%, #ff5fa3 100%);
      --card-shadow: 0 15px 30px rgba(0,0,0,.15);
    }
    body{box-sizing:border-box}
    .hero{
      background: radial-gradient(1200px 400px at 50% -50%, rgba(255,255,255,.35), transparent 60%), var(--grad);
    }
    .age-card{
      background:#fff;
      border-radius:24px;
      box-shadow: var(--card-shadow);
      transition: transform .2s ease, box-shadow .2s ease;
      position:relative;
      overflow:hidden;
    }
    .age-card:hover{ transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,.18); }
    .age-chip{ font-size:.7rem; letter-spacing:.06em }
    .glow{
      position:absolute; inset:-2px;
      background: conic-gradient(from 0deg,#ffd166,#fca5f1,#a78bfa,#60a5fa,#34d399,#ffd166);
      filter: blur(30px); opacity:.25;
      animation: spin 8s linear infinite;
    }
    @keyframes spin{ to{ transform:rotate(1turn)} }

    /* CAPI (mascote) */
    .capi-bubble{
      position:relative; background:#fff; border-radius:16px; padding:12px; margin:8px; box-shadow:var(--card-shadow)
    }
    .capi-bubble:after{
      content:''; position:absolute; bottom:-10px; left:24px; border:10px solid transparent; border-top-color:#fff
    }
    .float{ animation:float 3s ease-in-out infinite }
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}

    /* cards dos jogos */
    .game-card{
      background:linear-gradient(135deg,#667eea 0%, #764ba2 100%);
      border-radius:18px; padding:18px; color:#fff; text-align:center;
      transition:transform .18s ease;
    }
    .game-card:hover{ transform:scale(1.03) }

    .hidden{display:none}
  </style>
</head>
<body class="min-h-screen hero text-gray-900">

  <!-- Header -->
  <header class="bg-white/90 backdrop-blur-sm sticky top-0 z-40 shadow">
    <div class="container mx-auto px-4 py-4 flex items-center justify-between">
		<div class="flex items-center gap-3 relative">
		  <img src="img/capi2.png" alt="Capi" class="object-contain rounded-full shadow-lg transform -translate-y-1 hover:-translate-y-2 transition-all duration-300" style="width: 8em">
		  <h1 class="text-2xl md:text-3xl font-extrabold text-purple-700 uppercase tracking-wide drop-shadow-sm" style="font-size: 2em">
			CAPIGAMES
		  </h1>
		</div>
		<div class="flex items-center gap-3">
			<button id="toggleCapi" class="bg-yellow-400 hover:bg-yellow-500 text-purple-900 font-bold py-2 px-4 rounded-full">
				<span id="capiToggleText" style="font-size: 1em">üêπ DESABILITAR CAPI</span>
			</button>
			<button id="refreshBtn" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-full" title="Recarregar p√°gina / manifesto" style="font-size: 1em">
			  üîÑ ATUALIZAR JOGOS
			</button>
		</div>
    </div>
  </header>

  <!-- Hero -->
  <section class="text-center py-10 md:py-14">
    <h2 class="text-4xl md:text-6xl font-extrabold text-white drop-shadow-lg mb-3">BEM-VINDOS AO MUNDO DO CAPIGAMES</h2>
    <p class="text-white/90 uppercase max-w-3xl mx-auto">explore, aprenda e divirta-se com jogos educativos criados especialmente para cada idade!</p>

    <div class="mt-6">
      <button id="toggleSearchBtn" class="mx-auto bg-white text-purple-700 hover:bg-purple-50 font-bold py-3 px-6 rounded-full shadow">
        üîé BUSCAR JOGOS
      </button>
    </div>
  </section>

  <main class="container mx-auto px-4 pb-16">

    <!-- CONTROLES DE BUSCA (apenas na p√°gina inicial) -->
    <section id="searchBar" class="max-w-4xl mx-auto mb-8 bg-white/95 backdrop-blur-sm rounded-3xl p-6 shadow-2xl hidden">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold text-gray-700 mb-2">Palavra-chave</label>
          <input id="q" type="text" placeholder="Digite aqui‚Ä¶" class="w-full p-3 border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:outline-none uppercase">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Categoria</label>
          <select id="categoryFilter" class="w-full p-3 border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:outline-none">
            <option value="">Todas</option>
          </select>
        </div>
      </div>
      <div class="mt-3 flex gap-2">
        <button id="clearBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-full">üóëÔ∏è Limpar</button>
        <div id="manifestInfo" class="text-sm text-gray-600 self-center"></div>
      </div>
    </section>
	
    <!-- RESULTADOS DE BUSCA (aparecem ABAIXO dos cards) -->
    <section id="searchResults" class="hidden mt-8 mb-8">
      <h4 class="text-white text-xl font-bold mb-3 drop-shadow">Resultados</h4>
      <div id="resultsList" class="bg-white/95 backdrop-blur-sm rounded-3xl p-4 shadow-2xl"></div>
    </section>	

    <!-- CARDS DAS CATEGORIAS -->
    <section id="ageGroupsSection" class="grid grid-cols-1 md:grid-cols-5 gap-6" style="text-align: center;">
      <!-- 1 a 3 -->
      <div class="age-card p-6 cursor-pointer" onclick="openCategory('1-3')">
        <div class="glow"></div>
        <div class="relative">
          <div class="text-5xl mb-3">üß∏</div>
          <h3 class="text-xl font-extrabold text-purple-600">3 ANOS</h3>
          <p class="text-purple-400 text-sm -mt-1">CORES E FORMAS</p>
          <div class="mt-4">
            <span class="inline-block bg-rose-100 text-rose-600 px-3 py-1 rounded-full age-chip">EXPLORA√á√ÉO SENSORIAL</span>
            <div class="text-[11px] text-rose-500 mt-1">RECONHECIMENTO B√ÅSICO</div>
          </div>
        </div>
      </div>

      <!-- 4 a 5 -->
      <div class="age-card p-6 cursor-pointer" onclick="openCategory('4-5')">
        <div class="glow"></div>
        <div class="relative">
          <div class="text-5xl mb-3">üß©</div>
          <h3 class="text-xl font-extrabold text-emerald-600">4 E 5 ANOS</h3>
          <p class="text-emerald-400 text-sm -mt-1">LETRAS E N√öMEROS</p>
          <div class="mt-4">
            <span class="inline-block bg-blue-100 text-blue-600 px-3 py-1 rounded-full age-chip">ALFABETIZA√á√ÉO</span>
            <div class="text-[11px] text-blue-500 mt-1">PRIMEIRAS PALAVRAS</div>
          </div>
        </div>
      </div>

      <!-- 6 a 10 -->
      <div class="age-card p-6 cursor-pointer" onclick="openCategory('6-10')">
        <div class="glow"></div>
        <div class="relative">
          <div class="text-5xl mb-3">üßÆ</div>
          <h3 class="text-xl font-extrabold text-green-600">6 A 10 ANOS</h3>
          <p class="text-green-400 text-sm -mt-1">LEITURA E MATEM√ÅTICA</p>
          <div class="mt-4">
            <span class="inline-block bg-green-100 text-green-600 px-3 py-1 rounded-full age-chip">RACIOC√çNIO L√ìGICO</span>
            <div class="text-[11px] text-green-500 mt-1">RESOLU√á√ÉO DE PROBLEMAS</div>
          </div>
        </div>
      </div>

      <!-- 11 a 14 -->
      <div class="age-card p-6 cursor-pointer" onclick="openCategory('11-14')">
        <div class="glow"></div>
        <div class="relative">
          <div class="text-5xl mb-3">üî¨</div>
          <h3 class="text-xl font-extrabold text-indigo-600">11 A 14 ANOS</h3>
          <p class="text-indigo-400 text-sm -mt-1">CI√äNCIAS E CULTURA</p>
          <div class="mt-4">
            <span class="inline-block bg-indigo-100 text-indigo-600 px-3 py-1 rounded-full age-chip">PENSAMENTO CR√çTICO</span>
            <div class="text-[11px] text-indigo-500 mt-1">PROJETOS AVAN√áADOS</div>
          </div>
        </div>
      </div>

      <!-- NAEe -->
      <div class="age-card p-6 cursor-pointer" onclick="openCategory('naee')">
        <div class="glow"></div>
        <div class="relative">
          <div class="text-5xl mb-3">üåª</div>
          <h3 class="text-xl font-extrabold text-orange-600">SALA DO AEE</h3>
          <p class="text-orange-400 text-sm -mt-1">EDUCA√á√ÉO ESPECIAL</p>
          <div class="mt-4">
            <span class="inline-block bg-orange-100 text-orange-600 px-3 py-1 rounded-full age-chip">JOGOS ADAPTADOS</span>
            <div class="text-[11px] text-orange-500 mt-1">INCLUS√ÉO E ACESSIBILIDADE</div>
          </div>
        </div>
      </div>
    </section>

    <!-- LISTA DE JOGOS POR CATEGORIA -->
    <section id="gamesSection" class="hidden mt-10">
      <div class="flex items-center justify-between mb-4">
        <h3 id="gamesSectionTitle" class="text-2xl font-bold text-white drop-shadow">Jogos</h3>
        <button onclick="backHome()" class="bg-white/90 hover:bg-white text-purple-700 font-bold py-2 px-4 rounded-full shadow">‚¨ÖÔ∏è Voltar</button>
      </div>
      <div id="gamesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>
  </main>

  <!-- Mascote CAPI -->
	<div id="capiContainer" class="fixed bottom-6 right-6 flex flex-col items-end gap-2">
	  <div id="capiSpeech" class="capi-bubble hidden max-w-xs">
		<p id="capiMessage" class="text-purple-800 font-semibold"></p>
	  </div>
	  <div id="capi" class="cursor-pointer bg-orange-400 rounded-full shadow-2xl hover:bg-orange-500 flex items-center justify-center w-24 h-24" title="CAPI ‚Äî seu ajudante!">
		<img src="img/capi2.png" alt="Capi" class="object-contain rounded-full">
	  </div>
	</div>

  <script>
    /* ======= CONFIG ======= */
    const BASE_DIR = "games";
    const CATEGORY_ORDER = ["1-3","4-5","6-10","11-14","naee"];
    const CATEGORY_TITLES = {
      "1-3":"JOGOS PARA 1 A 3 ANOS",
      "4-5":"JOGOS PARA 4 E 5 ANOS",
      "6-10":"JOGOS PARA 6 A 10 ANOS",
      "11-14":"JOGOS PARA 11 A 14 ANOS",
      "naee":"SALA DO AEE - EDUCA√á√ÉO ESPECIAL"
    };

    let entries = [];                 // {path, title, category}
    let presentCategories = new Set();// categorias presentes
    let capiEnabled = true;

    // Refs UI
    const $ = s => document.querySelector(s);
    const searchBar = $("#searchBar");
    const manifestInfo = $("#manifestInfo");
    const ageGroupsSection = $("#ageGroupsSection");
    const searchResults = $("#searchResults");
    const resultsList = $("#resultsList");
    const gamesSection = $("#gamesSection");
    const gamesGrid = $("#gamesGrid");
    const gamesSectionTitle = $("#gamesSectionTitle");
    const qEl = $("#q");
    const categoryFilterEl = $("#categoryFilter");
    const clearBtn = $("#clearBtn");
    const toggleSearchBtn = $("#toggleSearchBtn");
    const refreshBtn = $("#refreshBtn");

    /* ======= CAPI (assistente) ======= */
    function showCapiMessage(message){
      if(!capiEnabled) return;
      const speech = $("#capiSpeech");
      $("#capiMessage").textContent = message;
      speech.classList.remove("hidden");
      setTimeout(()=>speech.classList.add("hidden"), 3000);
    }
    $("#capi").addEventListener("click", ()=> showCapiMessage("POSSO AJUDAR! CLIQUE EM UMA CATEGORIA OU BUSQUE UM JOGO. üêπ"));
    $("#toggleCapi").addEventListener("click", ()=>{
      capiEnabled = !capiEnabled;
      $("#capiContainer").style.display = capiEnabled ? "block" : "none";
      $("#capiToggleText").textContent = capiEnabled ? "‚ùå DESABILITAR CAPI" : "‚úÖ HABILITAR CAPI";
      if(capiEnabled) showCapiMessage("OBA! ESTOU DE VOLTA! üéâ");
    });

    /* ======= HELPERS ======= */
    const normalizeSlashes = p => p.replace(/\\/g,'/');
    const stripLeadingDots = p => p.replace(/^[.\/]+/,'');
    function firstFolderAfterBase(relPath){
      const p = normalizeSlashes(relPath);
      const parts = p.split('/').filter(Boolean);
      if(parts.length===0) return "";
      if (parts[0].toLowerCase() === BASE_DIR.toLowerCase()) return parts[1]?.toLowerCase() || "";
      return parts[0].toLowerCase();
    }
    function normalizeCategoryFromPath(relPath){
      const root = firstFolderAfterBase(relPath);
      return CATEGORY_ORDER.includes(root) ? root : null;
    }

    function renderFilters(){
      const cats = CATEGORY_ORDER.filter(c=>presentCategories.has(c));
      categoryFilterEl.innerHTML = `<option value="">Todas</option>` + cats.map(c=>`<option value="${c}">${c}</option>`).join("");
    }

    function drawGamesGrid(list){
      if(list.length===0){
        gamesGrid.innerHTML = `<div class="col-span-full text-center py-8 text-white/90">
          <div class="text-4xl mb-2">üòî</div><p class="text-xl font-bold">NENHUM JOGO ENCONTRADO</p></div>`;
        return;
      }
      gamesGrid.innerHTML = list.map(item=>`
        <a href="${encodeURI(item.path)}" class="game-card block" title="${item.title}">
          <div class="font-bold">${item.title}</div>
        </a>
      `).join("");
    }

    /* ======= BUSCA NA HOME ======= */
    function renderSearchResults(){
      const q = (qEl.value||"").trim().toUpperCase();
      const catFilter = categoryFilterEl.value;

      if(!q && !catFilter){
        searchResults.classList.add("hidden");
        resultsList.innerHTML = "";
        return;
      }

      let filtered = entries.filter(e=>{
        const inCat = !catFilter || e.category===catFilter;
        const t = (e.title||"").toUpperCase();
        const p = (e.path ||"").toUpperCase();
        const inText = !q || t.includes(q) || p.includes(q);
        return inCat && inText;
      });

      if(filtered.length===0){
        searchResults.classList.remove("hidden");
        resultsList.innerHTML = `<div class="text-center text-gray-600 py-6">Nenhum jogo encontrado.</div>`;
        return;
      }

      // lista simples com t√≠tulo e local
      const html = filtered.map(e=>`
        <a href="${encodeURI(e.path)}" class="flex items-center justify-between gap-3 px-3 py-2 rounded-lg hover:bg-purple-50 transition">
          <div>
            <div class="font-semibold text-purple-700">${e.title}</div>
            <div class="text-xs text-gray-600">${e.path}</div>
          </div>
          <span class="text-[11px] px-2 py-1 rounded-full bg-purple-100 text-purple-700 uppercase" style="font-size: larger;">${e.category}</span>
        </a>
      `).join("");

      resultsList.innerHTML = html;
      searchResults.classList.remove("hidden");
    }

    // mostrar/esconder barra de busca s√≥ na home
    toggleSearchBtn.addEventListener("click", ()=>{
      const open = searchBar.classList.contains("hidden");
      searchBar.classList.toggle("hidden");
      if(open) { showCapiMessage("VAMOS BUSCAR JOGOS INCR√çVEIS! üîç"); }
      else { showCapiMessage("TELA PRINCIPAL! üè†"); searchResults.classList.add("hidden"); qEl.value=""; categoryFilterEl.value=""; }
    });
    clearBtn.addEventListener("click", ()=>{
      qEl.value=""; categoryFilterEl.value=""; renderSearchResults();
    });
    qEl.addEventListener("input", renderSearchResults);
    categoryFilterEl.addEventListener("change", renderSearchResults);

    /* ======= FLUXO: CARREGAR MANIFESTO (OBRIGAT√ìRIO) ======= */
    function loadManifest(){
      const m = window.CAPI_MANIFEST;
      if(!m || !Array.isArray(m.entries)){
        manifestInfo.innerHTML = `<span class="text-rose-600 font-semibold">Manifesto n√£o encontrado.</span> Execute <strong>generate-manifest.vbs</strong>.`;
        showCapiMessage("Precisa gerar o manifesto primeiro. üìÑ");
        return false;
      }
      const fixed = [];
      for(const e of m.entries){
        if(!e || !e.path) continue;
        const p = stripLeadingDots(normalizeSlashes(e.path));
        const cat = normalizeCategoryFromPath(p);
        if(!cat) continue;
        const withBase = p.toLowerCase().startsWith(BASE_DIR.toLowerCase()+"/") ? p : `${BASE_DIR}/${p}`;
        fixed.push({ path: withBase, title: e.title || withBase.split("/").pop().replace(/\.html?$/i,""), category: cat });
      }
      entries = fixed;
      presentCategories = new Set(entries.map(e=>e.category));
      renderFilters();
      manifestInfo.textContent = `Manifesto: ${m.generated_at || "desconhecido"} ‚Ä¢ Jogos: ${entries.length}`;
      showCapiMessage(`Manifesto carregado ‚Ä¢ ${entries.length} jogo(s)`);
      return true;
    }

    /* ======= NAVEGA√á√ÉO DE CATEGORIA ======= */
    function openCategory(cat){
      const list = entries.filter(e=>e.category===cat);
      gamesSectionTitle.textContent = CATEGORY_TITLES[cat] || "Jogos";
      ageGroupsSection.classList.add("hidden");
      searchBar.classList.add("hidden");      // busca s√≥ na home
      searchResults.classList.add("hidden");  // e resultados tamb√©m
      gamesSection.classList.remove("hidden");
      drawGamesGrid(list);
      showCapiMessage(`√ìTIMA ESCOLHA! üí°`);
    }
    function backHome(){
      gamesSection.classList.add("hidden");
      ageGroupsSection.classList.remove("hidden");
      // n√£o abre automaticamente a busca; fica como estava
      showCapiMessage("TELA PRINCIPAL! üè†");
    }

    /* ======= START ======= */
    refreshBtn.addEventListener("click", ()=>location.reload());

    window.addEventListener("DOMContentLoaded", ()=>{
      loadManifest();  // obrigat√≥rio
      // dica inicial
      setTimeout(()=> showCapiMessage("OL√Å! ESCOLHA SUA CATEGORIA OU CLIQUE EM BUSCAR JOGOS. üéÆ"), 800);
    });

    // Expor fun√ß√µes de navega√ß√£o no escopo global
    window.openCategory = openCategory;
    window.backHome = backHome;
  </script>
</body>
</html>


